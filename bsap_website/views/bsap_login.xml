<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data noupdate="0">
        <template id="bsap_login" name="Login" inherit_id="web.login">
            <xpath expr="//form" position="replace">
                <script>
                    function validateCaptcha() {
                        var userCaptcha = document.getElementById('user_captcha').value;
                        var readonlyCaptcha = document.getElementById('readonly_captcha').value;
                
                        if (userCaptcha === readonlyCaptcha) {
                            // Captcha validation passed
                            return true; // Allow the form submission
                        } else {
                            // Captcha validation failed
                            alert('Captcha is incorrect. Please try again.');
                            return false; // Block the form submission
                        }
                    }
                
                    function generateAlphanumericCaptcha() {
                        var characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
                        var captcha = '';
                        for (var i = 0; i &#60; 6; i++) {
                            captcha += characters.charAt(Math.floor(Math.random() * characters.length));
                        }
                        return captcha;
                    }
                
                    function refreshCaptcha() {
                        var newCaptcha = generateAlphanumericCaptcha();
                        document.getElementById('readonly_captcha').value = newCaptcha;
                    }
                
                    // Initial generation on page load
                    document.addEventListener('DOMContentLoaded', function() {
                        refreshCaptcha();
                    });
                </script>
      
                <form class="oe_login_bsap" role="form" t-attf-action="/web/login" method="post" onsubmit="return validateCaptcha()">
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                    <div class="login-patch">
                        <div class="row">
                            <div class="col-md-5">
                                <div class="logo-layout">
                                    <div class="login-logo">
                                        <img src="/bsap_website/static/src/img/bihar-govt.png" alt="logo-one" class="header__imgOne "/>
                                        <img src="/bsap_website/static/src/img/bsap-logo.png" alt="logo-two" class="header__imgTwo "/>
                                        <div class="d-inline-block">
                                            <a href="/" class="text-decoration-none text-dark"><h5 class="d-inline-block  mb-0 logo-title ">Bihar Special Armed Police</h5>
                                                <small class="d-block">Government of Bihar</small>
                                            </a>
                                        </div>
                                    </div>
                                    <div class="form-group field-db" t-if="databases and len(databases) &gt; 1">
                                        <label for="db" class="col-form-label">Database</label>
                                        <div t-attf-class="input-group {{'input-group-sm' if form_small else ''}}">
                                            <input type="text" name="db" t-att-value="request.db" id="db" t-attf-class="form-control #{'form-control-sm' if form_small else ''}" required="required" readonly="readonly"/>
                                            <span class="input-group-append">
                                                <a role="button" href="/web/database/selector" class="btn btn-secondary">Select <i class="fa fa-database" role="img" aria-label="Database" title="Database"></i></a>
                                            </span>
                                        </div>
                                    </div>

                                    <div class="login-form">
                                        <h3 class="text-blue section__Heading">LogIn</h3>
                                        <div class="row">
                                            <div class="col-md-12 form-group field-login">
                                                <label for="login" class="mb-0">Username</label>
                                                <input type="text" placeholder="Username" name="login" t-att-value="login" id="login" t-attf-class="form-control #{'form-control-sm' if form_small else ''}" required="required" autofocus="autofocus" autocapitalize="off"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 form-group field-password">
                                                <label for="password" class="mb-0">Password</label>
                                                <input type="password" placeholder="Password" name="password" id="password" t-attf-class="form-control #{'form-control-sm' if form_small else ''}" required="required" autocomplete="current-password" t-att-autofocus="'autofocus' if login else None" maxlength="4096"/>
                                                <!-- <a t-if="reset_password_enabled" t-attf-href="/web/reset_password?{{ keep_query() }}" class="float-end forgot-link  mb-4">Forget Password</a>  -->
                                            </div>
                                        </div>
                                        <p class="alert alert-danger" t-if="error" role="alert">
                                            <t t-esc="error"/>
                                        </p>
                                        <p class="alert alert-success" t-if="message" role="status">
                                            <t t-esc="message"/>
                                        </p>
                                        <div class="row">
                                        <label>Enter Captcha</label>
                                            <div class="col-md-6">
                                                <input type="text" readonly="readonly" class="form-control" id="readonly_captcha" oncontextmenu="return false;" onselectstart="return false;" oncopy="return false;" oncut="return false;" ondrag="return false;" ondrop="return false;"/>
                                            </div>
                                            <div class="col-md-6">
                                                <input type="text" name="captcha" id="user_captcha" class="form-control" placeholder="Enter Captcha" required="True"/>
                                                <i class="bi bi-arrow-clockwise refresh-icon" onclick="refreshCaptcha()"></i>
                                            </div>
                                        </div>                  
                                        <div class="row">
                                            <div class="col-md-12">
                                                <button class="btn btn-primary w-100 btn-blue mt-2" type="submit" >SIGN IN</button>
                                                <a t-if="reset_password_enabled" t-attf-href="/web/reset_password?{{ keep_query() }}" class="float-end forgot-link  mb-4">Forget Password</a> 
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-7">
                                <img src="/bsap_website/static/src/img/login-bg.png" alt="login-bg" class="login-bg" />
                            </div>
                        </div>
                    </div>
                    <input type="hidden" name="redirect" t-att-value="redirect"/>
                </form>

              
            </xpath>
        </template>


        <template id="bsap_login_assets" inherit_id="bsap_website.bsap_login">
            <xpath expr='.' position="inside">
                <link rel="stylesheet" href="/bsap_website/static/src/css/login.css" />
            </xpath>
        </template>

    </data>
</odoo>
