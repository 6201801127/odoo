<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_project_config_view">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout" t-lang="hi_IN">
                    <p style="display: inline-block;">
                        <span t-esc="time.strftime('%d-%b-%Y %I:%M %p')"/>
                    </p>
                    <h3 class="text-center mt-2">
                        <b>Project Configuration Report</b>
                    </h3>
                    <br/>
                    <br/>
                    <table style="width: 100%;">
                        <tr class='row1' style="height: 30px;">
                            <td style="font-weight:bold; width: 15%;">Project Name</td>
                            <td style="font-family: Segoe UI,arial,sans-serif; border-left: 1px solid black; padding-left: 10px;">
                                <span t-field="o.project_id"/>
                            </td>
                        </tr>
                        <tr class='row2' style="height: 30px;">
                            <td style="font-weight:bold;">Project Code</td>
                            <td style="font-family: Segoe UI,arial,sans-serif; border-left: 1px solid black; padding-left: 10px;">
                                <span t-field="o.project_code"/>
                            </td>
                        </tr>
                        <tr class='row3' style="height: 30px;">
                            <td style="font-weight:bold;">SCM</td>
                            <td style="font-family: Segoe UI,arial,sans-serif; border-left: 1px solid black; padding-left: 10px;">
                                <span t-field="o.scm_data"/>
                            </td>
                        </tr>
                        <tr class='row4' style="height: 30px;">
                            <td style="font-weight:bold;">Email</td>
                            <td style="font-family: Segoe UI,arial,sans-serif; border-left: 1px solid black; padding-left: 10px;">
                                <span t-field="o.email"/>
                            </td>
                        </tr>
                        <tr class='row5' style="height: 30px;">
                            <td style="font-weight:bold;">SSL</td>
                            <td style="font-family: Segoe UI,arial,sans-serif; border-left: 1px solid black; padding-left: 10px;">
                                <span t-field="o.ssl"/>
                            </td>
                        </tr>
                        <tr class='row6' style="height: 30px;">
                            <td style="font-weight:bold;">SMS</td>
                            <td style="font-family: Segoe UI,arial,sans-serif; border-left: 1px solid black; padding-left: 10px;">
                                <span t-field="o.sms"/>
                            </td>
                        </tr>
                        <tr class='row7' style="height: 30px;">
                            <td style="font-weight:bold;">Note</td>
                            <td style="font-family: Segoe UI,arial,sans-serif; border-left: 1px solid black; padding-left: 10px;">
                                <span t-field="o.remarks"/>
                            </td>
                        </tr>
                        <tr>
                            <td style="font-weight:bold;">Kickoff</td>
                            <td style="font-family: Segoe UI,arial,sans-serif; border-left: 1px solid black; padding-left: 10px;">
                                <table style="border-top: 1px solid black; width: 100%;" cellpadding="5" cellspacing="0">
                                    <tr class='row1' style="height: 40px; background-color: #ebecf0;">
                                        <th style="width: 50%; text-align: left; vertical-align: middle; border: 1px solid black; padding-left:2px;">Type</th>
                                        <th style="width: 50%; text-align: left; vertical-align: middle; border: 1px solid black; padding-left:2px;">Date</th>
                                    </tr>
                                    <t t-foreach="o.kickoff_ids" t-as="kickoff">
                                        <tr style="height: 40px; ">
                                            <td style="font-family: Segoe UI,arial,sans-serif; text-align: left; vertical-align: middle;border: 1px solid black; padding-left:2px;">
                                                <span t-field="kickoff.type_kickoff"/>
                                            </td>
                                            <td style="font-family: Segoe UI,arial,sans-serif; text-align: left; vertical-align: middle; border: 1px solid black; padding-left:2px;">
                                                <span t-field="kickoff.date_of_start"/>
                                            </td>
                                        </tr>
                                    </t>
                                </table>
                            </td>
                        </tr>
                        <tr class='row7' style="height: 30px;">
                            <td style="font-weight:bold;">Domain and Subdomain</td>
                            <td style="font-family: Segoe UI,arial,sans-serif; border-left: 1px solid black; padding-left: 10px; padding-top:5px;">
                                <table style="border-top: 1px solid black; width: 100%;">
                                    <tr class='row1' style="height: 40px; border: 1px solid black; background-color: #ebecf0;">
                                        <th style="width: 40%; text-align: left; vertical-align: middle;white-space: nowrap; padding-left: 2px; border: 1px solid black;">Domain</th>
                                        <th style="width: 30%; text-align: left; vertical-align: middle;white-space: nowrap; padding-left: 2px; border: 1px solid black;">URL Type</th>
                                        <th style="width: 30%; text-align: left; vertical-align: middle;white-space: nowrap; padding-left: 2px; border: 1px solid black;">Remark</th>
                                    </tr>
                                    <t t-foreach="o.domain_ids" t-as="domain">
                                        <tr style="height: 40px; border: 1px solid black;">
                                            <td style="font-family: Segoe UI,arial,sans-serif; text-align: left; vertical-align: middle; padding-left: 2px; border: 1px solid black;">
                                                <span t-field="domain.domain_id"/>
                                            </td>
                                            <td style="font-family: Segoe UI,arial,sans-serif; text-align: left; vertical-align: middle; padding-left: 2px; border: 1px solid black;">
                                                <span t-field="domain.url_type_id"/>
                                            </td>
                                            <td style="font-family: Segoe UI,arial,sans-serif; text-align: left; vertical-align: middle; padding-left: 2px; border: 1px solid black;">
                                                <span t-field="domain.remark"/>
                                            </td>
                                        </tr>
                                    </t>
                                </table>
                            </td>
                        </tr>
                    </table>

                    <br/>

                    <table style="border-top: 1px solid black; width: 100%; font-size:13px;">
                        <tr class='row1' style="height: 40px; background-color: #ebecf0; ">
                            <th style="width: 2%; text-align: left; vertical-align: middle; white-space: nowrap; padding-left: 2px; border: 1px solid black;">Sl.No</th>
                            <th style="width: 8%; text-align: left; vertical-align: middle; white-space: nowrap; padding-left: 2px; border: 1px solid black;">Environment</th>
                            <th style="width: 10%; text-align: left; vertical-align: middle; white-space: nowrap; padding-left: 2px; border: 1px solid black;">Infra Details</th>
                            <th style="width: 10%; text-align: left; vertical-align: middle; white-space: nowrap; padding-left: 2px; border: 1px solid black;">Server Name</th>
                            <th style="width: 5%; text-align: center; vertical-align: middle; white-space: nowrap; padding-left: 2px; border: 1px solid black;">CPU Nos</th>
                            <th style="width: 5%; text-align: center; vertical-align: middle; white-space: nowrap; padding-left: 2px; border: 1px solid black;">RAM</th>
                            <th style="width: 10%; text-align: left; vertical-align: middle; white-space: nowrap; padding-left: 2px; border: 1px solid black;">Hosting Type</th>
                            <th style="width: 10%; text-align: left; vertical-align: middle; white-space: nowrap; padding-left: 2px; border: 1px solid black;">Application</th>
                            <th style="width: 10%; text-align: left; vertical-align: middle; white-space: nowrap; padding-left: 2px; border: 1px solid black;">Database</th>
                            <th style="width: 10%; text-align: left; vertical-align: middle; white-space: nowrap; padding-left: 2px; border: 1px solid black;">Purpose</th>
                            <th style="width: 10%; text-align: left; vertical-align: middle; white-space: nowrap; padding-left: 2px; border: 1px solid black;">Data Center</th>
                            <th style="width: 10%; text-align: left; vertical-align: middle;white-space: nowrap; padding-left: 2px; border: 1px solid black;">Remark</th>
                        </tr>
                        <t t-set="env" t-value=""/>
                        <t t-set="cpu_count" t-value="0"/>
                        <t t-set="ram_count" t-value="0"/>
                        <t t-set="column_index" t-value="1"/>

                        <t t-foreach="o.environment_ids" t-as="environment">
                            <t t-if="environment.environment_id != env">
                                <t t-if="cpu_count > 0">
                                    <tr>
                                        <td style="border: 1px solid black; vertical-align: middle; text-align: right; font-weight: bold; padding-right: 2px;" colspan="4">Total</td>
                                        <td style="border: 1px solid black; vertical-align: middle; text-align: center; font-weight: bold;">
                                            <t t-esc="cpu_count"/>
                                        </td>
                                        <td style="border: 1px solid black; vertical-align: middle; text-align: center; font-weight: bold;">
                                            <t t-esc="ram_count"/>
                                        </td>
                                        <td style="border: 1px solid black; vertical-align: middle; text-align: right; font-weight: bold;" colspan="6"></td>
                                    </tr>
                                </t>


                                <t t-set="env" t-value="environment.environment_id"/>
                                <t t-set="cpu_count" t-value="environment.cpu"/>
                                <t t-set="ram_count" t-value="environment.ram_p"/>

                            </t>
                            <t t-else="">
                                <t t-set="cpu_count" t-value="cpu_count + environment.cpu"/>
                                <t t-set="ram_count" t-value="ram_count + environment.ram_p"/>
                            </t>
                            <tr style="">
                                <td style=" text-align: center; vertical-align: middle; padding-left: 2px; border: 1px solid black;">
                                    <t t-esc="column_index"/>
                                    <t t-set="column_index" t-value="column_index + 1"/>
                                </td>
                                <td style=" text-align: left; vertical-align: middle; padding-left: 2px; border: 1px solid black;">
                                    <span t-field="environment.environment_id"/>
                                </td>
                                <td style=" text-align: left; vertical-align: middle; padding-left: 2px; border: 1px solid black;">
                                    <span t-field="environment.infra_details"/>
                                </td>
                                <td style=" text-align: left; vertical-align: middle; padding-left: 2px; border: 1px solid black;">
                                    <span t-field="environment.server_id"/>
                                </td>
                                <td style=" text-align: center; vertical-align: middle; padding-left: 2px; border: 1px solid black;">
                                    <span t-field="environment.cpu"/>
                                </td>
                                <td style=" text-align: center; vertical-align: middle; padding-left: 2px; border: 1px solid black;">
                                    <span t-field="environment.ram_p"/>
                                </td>
                                <td style=" text-align: left; vertical-align: middle; padding-left: 2px; border: 1px solid black;">
                                    <span t-field="environment.dedicate_share"/>
                                </td>
                                <td style=" text-align: left; vertical-align: middle; padding-left: 2px; border: 1px solid black;">
                                    <span t-field="environment.application_id"/>
                                </td>
                                <td style=" text-align: left; vertical-align: middle; padding-left: 2px; border: 1px solid black;">
                                    <span t-field="environment.database_id"/>
                                </td>
                                <td style=" text-align: left; vertical-align: middle; padding-left: 2px; border: 1px solid black;">
                                    <span t-field="environment.purpose"/>
                                </td>
                                <td style=" text-align: left; vertical-align: middle; padding-left: 2px; border: 1px solid black;">
                                    <span t-field="environment.datacenter_id"/>
                                </td>
                                <td style=" text-align: left; vertical-align: middle; padding-left: 2px; border: 1px solid black;">
                                    <span t-field="environment.remark"/>
                                </td>
                            </tr>
                            <t t-if="environment_last">
                                <tr>
                                    <td style="border: 1px solid black; vertical-align: middle; text-align: right; font-weight: bold; padding-right: 2px;" colspan="4">Total</td>
                                    <td style="border: 1px solid black; vertical-align: middle; text-align: center; font-weight: bold;">
                                        <t t-esc="cpu_count"/>
                                    </td>
                                    <td style="border: 1px solid black; vertical-align: middle; text-align: center; font-weight: bold;">
                                        <t t-esc="ram_count"/>
                                    </td>
                                    <td style="border: 1px solid black; vertical-align: middle; text-align: right; font-weight: bold;" colspan="6"></td>
                                </tr>
                            </t>
                        </t>
                        <tr>
                            <td style="border: 1px solid black; font-weight: bold; text-align: right; padding-right: 2px;" colspan="4">
                                Grand Total
                            </td>
                            <td style="border: 1px solid black; vertical-align: middle; text-align: center; padding-right: 2px;">
                                <b>
                                    <t t-esc="sum(record['cpu'] for record in o.environment_ids)"/>
                                </b>
                            </td>
                            <td style="border: 1px solid black; vertical-align: middle; text-align: center; padding-right: 2px;">
                                <b>
                                    <t t-esc="sum(record['ram_p'] for record in o.environment_ids)"/>
                                </b>
                            </td>
                            <td style="border: 1px solid black; vertical-align: middle; text-align: right; padding-right: 2px;" colspan="6">

                            </td>
                        </tr>
                    </table>

                </t>
            </t>
        </t>
    </template>
    <record id="paper_format_project_config_pdf_report" model="report.paperformat">
        <field name="name">Project Configuration Report</field>
        <field name="default" eval="True"/>
        <field name="format">A4</field>
        <field name="page_height">0</field>
        <field name="page_width">0</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">4</field>
        <field name="margin_bottom">4</field>
        <field name="margin_left">4</field>
        <field name="margin_right">4</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">0</field>
        <field name="dpi">80</field>
    </record>
    <report string="Export PDF"
            print_report_name="'Project Configuration Report - %s' % (object.project_id.name)"
            id="project_config_pdf_report"
            model="kw_cr_project_configuration"
            report_type="qweb-pdf"
            attachment_use="True"
            name="change_request_management.report_project_config_view"
            file="change_request_management.report_project_config_view"
            paperformat="change_request_management.paper_format_project_config_pdf_report"/>
</odoo>