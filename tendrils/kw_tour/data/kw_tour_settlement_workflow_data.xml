<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">

        <record id="kw_tour_settlement_approval_workflow" model="odoo.workflow">
            <field name="name">Tour settlement Approval</field>
            <field name="activities_add" eval="True"/>
            <field name="followers_add" eval="False"/>
            <field name="mail_thread_add" eval="True"/>
            <field name="remove_default_attrs_mod" eval="False"/>
            <field name="model_id" ref="kw_tour.model_kw_tour_settlement"/>
        </record>

        <record id="kw_tour_settlement_workflow_node_draft" model="odoo.workflow.node">
            <field name="name">Draft</field>
            <field name="workflow_id" ref="kw_tour_settlement_approval_workflow"/>
            <field name="node_name">Draft</field>
            <field name="sequence" eval="1"/>
            <field name="is_visible" eval="True"/>
            <field name="flow_start" eval="True"/>
        </record>

        <record id="kw_tour_settlement_workflow_node_applied" model="odoo.workflow.node">
            <field name="name">Applied</field>
            <field name="workflow_id" ref="kw_tour_settlement_approval_workflow"/>
            <field name="node_name">Applied</field>
            <field name="sequence" eval="2"/>
            <field name="is_visible" eval="True"/>
            <field name="flow_start" eval="False"/>
        </record>

        <record id="kw_tour_settlement_workflow_node_forwarded" model="odoo.workflow.node">
            <field name="name">Forwarded</field>
            <field name="workflow_id" ref="kw_tour_settlement_approval_workflow"/>
            <field name="node_name">Forwarded</field>
            <field name="sequence" eval="3"/>
            <field name="is_visible" eval="False"/>
            <field name="flow_end" eval="False"/>
        </record>

        <record id="kw_tour_settlement_workflow_node_approved" model="odoo.workflow.node">
            <field name="name">Approved</field>
            <field name="workflow_id" ref="kw_tour_settlement_approval_workflow"/>
            <field name="node_name">Approved</field>
            <field name="sequence" eval="4"/>
            <field name="is_visible" eval="True"/>
            <field name="flow_end" eval="False"/>
        </record>

        <record id="kw_tour_settlement_workflow_node_finance_settled" model="odoo.workflow.node">
            <field name="name">Granted</field>
            <field name="workflow_id" ref="kw_tour_settlement_approval_workflow"/>
            <field name="node_name">Granted</field>
            <field name="sequence" eval="5"/>
            <field name="is_visible" eval="True"/>
            <field name="flow_end" eval="True"/>
        </record>

        <record id="kw_tour_settlement_workflow_node_finance_paid" model="odoo.workflow.node">
            <field name="name">Payment Done</field>
            <field name="workflow_id" ref="kw_tour_settlement_approval_workflow"/>
            <field name="node_name">Payment Done</field>
            <field name="sequence" eval="6"/>
            <field name="is_visible" eval="True"/>
            <field name="flow_end" eval="True"/>
        </record>
       
        <record id="kw_tour_settlement_workflow_node_rejected" model="odoo.workflow.node">
            <field name="name">Rejected</field>
            <field name="workflow_id" ref="kw_tour_settlement_approval_workflow"/>
            <field name="node_name">Rejected</field>
            <field name="sequence" eval="7"/>
            <field name="is_visible" eval="False"/>
            <field name="flow_end" eval="True"/>
        </record>

       
         <record id="kw_tour_settlement_workflow_button_apply" model="odoo.workflow.node.button">
            <field name="sequence" eval="1"/>
            <field name="workflow_id" ref="kw_tour_settlement_approval_workflow"/>
            <field name="name">Apply</field>
            <field name="node_id" ref="kw_tour_settlement_workflow_node_draft"/>
            <field name="is_highlight" eval="True"/>
            <field name="custom_domain" eval="True"/>
            <field name="btn_hide_domain" eval="[('state', '!=', 'Draft')]"/>
            <field name="btn_class">btn-success</field>
            <field name="condition_code">
result = True
            </field>
            <field name="action_type">code</field>
            <field name="code">
result = obj.settlement_approval_flow()
<!--current_date = date.today()-->
<!--return_date_after_7_days = obj.date_return + timedelta(days=7)-->
<!--if not current_date &gt;= obj.date_return:-->
<!--    warning("Settlement can be applied after return date")-->
<!--#if not current_date &lt;= return_date_after_7_days:-->
<!--#    warning("Settlement can be applied within 7 days after return date.")-->

<!--parent_id = obj.employee_id and obj.employee_id.parent_id and obj.employee_id.parent_id.id or False-->
<!--print(parent_id, '==================>>>>>>>')                -->
<!--if not parent_id:-->
<!--    obj.write({'state':'Approved','final_approver_id':parent_id,'applied_datetime':datetime.now(),'action_datetime':datetime.now()},no_notify=True)-->
<!--    template = env.ref('kw_tour.kw_tour_settlement_applied_without_ra_mail')-->
<!--    finance_users = env.ref('kw_tour.group_kw_tour_finance').users-->
<!--    finance_users_emails = ','.join(finance_users.mapped("employee_ids.work_email"))-->
<!--    template.with_context(email_users = finance_users_emails).send_mail(obj.id, notif_layout="kwantify_theme.csm_mail_notification_light")-->
<!--else:-->
<!--    obj.write({'state':'Applied','final_approver_id':parent_id,'applied_datetime':datetime.now(),'action_datetime':datetime.now()},no_notify=True)-->
<!--    approver = obj._get_tour_approver()-->
<!--    template = env.ref('kw_tour.kw_tour_settlement_applied_mail')-->
<!--    template.with_context(email = approver.work_email, name=approver.name).send_mail(obj.id,notif_layout="kwantify_theme.csm_mail_notification_light")-->
<!--user.notify_success("Settlement Applied Successfully.")-->
            </field>
        </record>

        <record id="kw_tour_settlement_workflow_button_aprove" model="odoo.workflow.node.button">
            <field name="sequence" eval="2"/>
            <field name="workflow_id" ref="kw_tour_settlement_approval_workflow"/>
            <field name="name">Approve</field>
            <field name="node_id" ref="kw_tour_settlement_workflow_node_applied"/>
            <field name="is_highlight" eval="True"/>
            <field name="custom_domain" eval="True"/>
            <field name="btn_hide_domain" eval="['|',('state', 'not in', ['Applied','Forwarded']),('own_record','=',True)]"/>
            <field name="btn_class">btn-success</field>
            <field name="condition_code">
result = True
            </field>
            <field name="action_type">code</field>
            <field name="code">
form_view_id = env.ref("kw_tour.view_kw_tour_settlement_approve_remark_form").id 
if obj.additional_exp_boolean == True:
    form_view_id = env.ref("kw_tour.view_kw_tour_settlement_approve_additional_expenses").id
    name="Extra Additonal Expenses Warning !"
action= {
    'name':'Remarks',
    'type': 'ir.actions.act_window',
    'res_model': 'kw_tour_settlement',
    'view_mode': 'form',
    'view_type': 'form',
    'res_id': obj.id,
    'view_id': form_view_id,
    'target': 'new',
    'domain': [('id', '=', obj.id)],
    'nodestroy': True,
    }
            </field>
        </record>

         <record id="kw_tour_settlement_workflow_button_forward" model="odoo.workflow.node.button">
            <field name="sequence" eval="3"/>
            <field name="workflow_id" ref="kw_tour_settlement_approval_workflow"/>
            <field name="name">Forward</field>
            <field name="node_id" ref="kw_tour_settlement_workflow_node_applied"/>
            <field name="is_highlight" eval="True"/>
            <field name="custom_domain" eval="True"/>
            <field name="btn_hide_domain" eval="['|',('state', 'not in', ['Applied','Forwarded']),('own_record','=',True)]"/>
            <field name="btn_class">btn-warning</field>
            <field name="condition_code">
result = True
            </field>
            <field name="action_type">code</field>
            <field name="code">
form_view_id = env.ref("kw_tour.view_kw_tour_settlement_forward_remark_form").id 
action= {
    'name':'Remarks',
    'type': 'ir.actions.act_window',
    'res_model': 'kw_tour_settlement',
    'view_mode': 'form',
    'view_type': 'form',
    'res_id': obj.id,
    'view_id': form_view_id,
    'target': 'new',
    'domain': [('id', '=', obj.id)],
    'nodestroy': True,
    }
            </field>
        </record>

        <record id="kw_tour_settlement_workflow_button_finance_done" model="odoo.workflow.node.button">
            <field name="sequence" eval="4"/>
            <field name="workflow_id" ref="kw_tour_settlement_approval_workflow"/>
            <field name="name">Grant</field>
            <field name="node_id" ref="kw_tour_settlement_workflow_node_approved"/>
            <field name="is_highlight" eval="True"/>
            <field name="custom_domain" eval="True"/>
            <field name="btn_hide_domain" eval="['|','|',('state', '!=', 'Approved'),('own_record','=',True),('finance_access','=',False)]"/>
            <field name="btn_class">btn-success</field>
            <field name="condition_code">
result = True
            </field>
            <field name="action_type">code</field>
            <field name="code">
form_view_id = env.ref("kw_tour.view_kw_tour_settlement_finance_settle_remark_form").id 
action= {
    'name':'Remarks',
    'type': 'ir.actions.act_window',
    'res_model': 'kw_tour_settlement',
    'view_mode': 'form',
    'view_type': 'form',
    'res_id': obj.id,
    'view_id': form_view_id,
    'target': 'new',
    'domain': [('id', '=', obj.id)],
    'nodestroy': True,
    }
            </field>
        </record>

        <record id="kw_tour_settlement_workflow_button_finance_paid" model="odoo.workflow.node.button">
            <field name="sequence" eval="5"/>
            <field name="workflow_id" ref="kw_tour_settlement_approval_workflow"/>
            <field name="name">Payment Done</field>
            <field name="node_id" ref="kw_tour_settlement_workflow_node_finance_paid"/>
            <field name="is_highlight" eval="True"/>
            <field name="custom_domain" eval="True"/>
            <field name="btn_hide_domain" eval="['|','|',('state', '!=', 'Granted'),('own_record','=',True),('finance_access','=',False)]"/>
            <field name="btn_class">btn-success</field>
            <field name="condition_code">
result = True
            </field>
            <field name="action_type">code</field>
            <field name="code">
form_view_id = env.ref("kw_tour.view_kw_tour_settlement_paid_remark_form").id 
action= {
    'name':'Remarks',
    'type': 'ir.actions.act_window',
    'res_model': 'kw_tour_settlement',
    'view_mode': 'form',
    'view_type': 'form',
    'res_id': obj.id,
    'view_id': form_view_id,
    'target': 'new',
    'domain': [('id', '=', obj.id)],
    'nodestroy': True,
    }
            </field>
        </record>

        <record id="kw_tour_settlement_workflow_button_reject" model="odoo.workflow.node.button">
            <field name="sequence" eval="5"/>
            <field name="workflow_id" ref="kw_tour_settlement_approval_workflow"/>
            <field name="name">Reject</field>
            <field name="node_id" ref="kw_tour_settlement_workflow_node_rejected"/>
            <field name="is_highlight" eval="True"/>
            <field name="custom_domain" eval="True"/>
            <field name="btn_hide_domain" eval="['|',('state', 'in', ['Draft','Granted','Payment Done']),('own_record','=',True)]"/>
            <field name="btn_class">btn-danger</field>
            <field name="condition_code">
result = True
            </field>
            <field name="action_type">code</field>
            <field name="code">
form_view_id = env.ref("kw_tour.view_kw_tour_settlement_reject_remark_form").id 
action= {
    'name':'Remarks',
    'type': 'ir.actions.act_window',
    'res_model': 'kw_tour_settlement',
    'view_mode': 'form',
    'view_type': 'form',
    'res_id': obj.id,
    'view_id': form_view_id,
    'target': 'new',
    'domain': [('id', '=', obj.id)],
    'nodestroy': True,
    }
            </field>
        </record>

    </data>
</odoo>