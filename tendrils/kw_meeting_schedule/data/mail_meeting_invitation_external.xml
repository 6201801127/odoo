<?xml version="1.0"?>
<odoo>
    <data noupdate="0">

        <record id="kw_meeting_calendar_template_meeting_invitation_external" model="mail.template">
            <field name="name">Calendar: Meeting Invitation</field>
            <field name="model_id" ref="kw_meeting_schedule.model_kw_meeting_external_participants"/>
            <field name="subject">Meeting Scheduled for ${object.meeting_id.name} by ${object.meeting_id.user_id.name} | ${object.meeting_id.display_time}</field>
            <field name="email_from">${object.create_uid.email}</field>
            <!-- <field name="email_to" >${(object.email|safe)}</field> -->
            <field name="email_to" >${('' if object.partner_id and object.partner_id.email and object.partner_id.email==object.email else object.email|safe)}</field>
            <field name="partner_to">${object.partner_id and object.partner_id.email and object.partner_id.email==object.email and object.partner_id.id or False }</field>
            <field name="lang">${object.partner_id.lang}</field>
            <field name="body_html" type="html">
                <div>
                    % set colors = {'needsAction': 'grey', 'accepted': 'green', 'tentative': '#FFFF00',  'declined': 'red'}
                    <p>Hello ${object.partner_id.name},</p>

                    <p>
                        ${object.meeting_id.user_id.partner_id.name} invited you for the <strong>${object.meeting_id.name} meeting</strong>
                        of ${object.meeting_id.user_id.company_id.name}.
                    </p>
                    <div style="text-align: center; margin: 16px 0px 16px 0px;">
                        <a href="/meeting_schedule/meeting/accept?db=${'dbname' in ctx and ctx['dbname'] or ''}&amp;token=${object.access_token}&amp;action=${'action_id' in ctx and ctx['action_id'] or ''}&amp;id=${object.meeting_id.id}" 
                            style="padding: 5px 10px; color: #FFFFFF; text-decoration: none; background-color: #875A7B; border: 1px solid #875A7B; border-radius: 3px">
                            Accept</a>
                        <a href="/meeting_schedule/meeting/decline?db=${'dbname' in ctx and ctx['dbname'] or '' }&amp;token=${object.access_token}&amp;action=${'action_id' in ctx and ctx['action_id'] or ''}&amp;id=${object.meeting_id.id}" 
                            style="padding: 5px 10px; color: #FFFFFF; text-decoration: none; background-color: #875A7B; border: 1px solid #875A7B; border-radius: 3px">
                            Decline</a>
                        <a href="/meeting_schedule/meeting/view?db=${'dbname' in ctx and ctx['dbname'] or ''}&amp;token=${object.access_token}&amp;action=${'action_id' in ctx and ctx['action_id'] or ''}&amp;id=${object.meeting_id.id}" 
                            style="padding: 5px 10px; color: #FFFFFF; text-decoration: none; background-color: #875A7B; border: 1px solid #875A7B; border-radius: 3px">
                            View</a>
                    </div>
                    <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                        <tr style="width:100%;">
                            <td style="width:70%">
                                <p><strong>Meeting Details: </strong></p>
                                <table border="0" cellpadding="5" cellspacing="0">
                                      <tr t-if="object.meeting_id.meeting_room_id">
                                          <td>Meeting Room</td>
                                          <td>:</td>
                                          <td> <span style="margin-left:5px">${object.meeting_id.meeting_room_id.name}(${object.meeting_id.meeting_room_id.floor_name})</span></td>
                                      </tr>
                                    % if object.meeting_id.agenda_ids:
                                      <tr>
                                          <td style="width: 30%;vertical-align:top;">Agenda</td>
                                          <td style="width: 5%;vertical-align:top;">:</td>
                                          <td style="width: 65%">
                                            % for agenda in object.meeting_id.agenda_ids:
                                                  <li>
                                                    <span style="margin-left:5px">${agenda.name}</span>
                                                </li>
                                            % endfor
                                          </td>
                                      </tr>
                                    % endif
                                    % if object.meeting_id.description:
                                      <tr>
                                          <td style="width: 30%">Required Information</td>
                                          <td style="width: 5%">:</td>
                                          <td style="width: 65%">
                                               % if object.meeting_id.description:
                                              <span style="margin-left:5px"> ${object.meeting_id.description}</span>
                                                % endif
                                          </td>
                                      </tr>
                                    % endif
                                     % if object.meeting_id.recurrency:
                                      <tr>
                                          <td style="width: 30%;vertical-align:top;">Meeting Type: </td>
                                          <td style="width: 5%;vertical-align:top;">:</td>
                                          <td style="width: 65%">
                                                  % for recurring_event in object.meeting_id.child_ids:
                                                        <div style="margin-left:5px;margin-bottom:5px;">${recurring_event.display_time}</div>
                                                % endfor
                                          </td>
                                      </tr>
                                    % endif
                                    % if not object.meeting_id.allday and object.meeting_id.duration:
                                      <tr>
                                          <td style="width: 30%">Duration</td>
                                          <td style="width: 5%">:</td>
                                          <td style="width: 65%">
                                              <span style="margin-left:5px"> ${('%dH:%dM' % (object.meeting_id.duration,(object.meeting_id.duration*60)%60))}</span>
                                          </td>
                                      </tr>
                                     % endif
                                     % if object.meeting_id.mom_required:
                                      <tr>
                                          <td style="width: 30%">MOM Controller</td>
                                          <td style="width: 5%">:
                                          </td>
                                          <td style="width: 65%">
                                              <span style="margin-left:5px">${object.meeting_id.mom_controller_id.name}</span>
                                          </td>
                                      </tr>
                                    % endif
                                      <tr t-if="object.meeting_id.attendee_ids">
                                          <td style="width: 30%;vertical-align:top;">Attendees</td>
                                          <td  style="width: 5%;vertical-align:top;">:</td>
                                          <td  style="width: 65%">
                                             % for attendee in object.meeting_id.attendee_ids:
                                              % if attendee.is_external == False:
                                                    <div style="margin-left:5px;margin-bottom:5px">${loop.index}. ${attendee.common_name}</div>
                                                % endif
                                            % endfor
                                          </td>
                                      </tr>
                                    % if object.meeting_id.external_attendee_ids:
                                      <tr>
                                          <td style="width: 30%;vertical-align:top;"> External Participants</td>
                                          <td style="width: 5%;vertical-align:top;">:</td>
                                          <td style="width: 65%">
                                             % for ext_attendee in object.meeting_id.external_attendee_ids:
                                                    <div style="margin-left:5px;margin-bottom:5px;">${loop.index}. ${ext_attendee.partner_id.name} ${ext_attendee.partner_id.mobile_no}</div>
                                            % endfor
                                          </td>
                                      </tr>
                                     % endif
                                     % if object.meeting_id.mpin:
                                      <tr>
                                          <td style="width: 30%;vertical-align:top;"> Mpin</td>
                                          <td style="width: 5%;vertical-align:top;">:</td>
                                          <td style="width: 65%">
                                            <div style="margin-left:5px;margin-bottom:5px;">${object.meeting_id.mpin}</div>
                                          </td>
                                      </tr>
                                     % endif
                                </table>
                            </td>
                             <td style="width:30%">
                                % if not object.meeting_id.recurrency:
                                        <div style="border-top-left-radius: 3px; border-top-right-radius: 3px; font-size: 12px; border-collapse: separate; text-align: center; font-weight: bold; color: #ffffff; min-height: 18px; background-color: #875A7B; border: 1px solid #875A7B;">
                                            ${object.meeting_id.get_interval('dayname', tz=object.partner_id.tz if not object.meeting_id.allday else None)}
                                        </div>
                                        <div style="font-size: 48px; min-height: auto; font-weight: bold; text-align: center; color: #5F5F5F; background-color: #F8F8F8; border: 1px solid #875A7B;">
                                            ${object.meeting_id.get_interval('day', tz=object.partner_id.tz if not object.meeting_id.allday else None)}
                                        </div>
                                        <div style='font-size: 12px; text-align: center; font-weight: bold; color: #ffffff; background-color: #875A7B;'>
                                            ${object.meeting_id.get_interval('month', tz=object.partner_id.tz if not object.meeting_id.allday else None)}
                                        </div>
                                        <div style="border-collapse: separate; color: #5F5F5F; text-align: center; font-size: 12px; border-bottom-right-radius: 3px; font-weight: bold; border: 1px solid #875A7B; border-bottom-left-radius: 3px;">
                                            ${not object.meeting_id.allday and object.meeting_id.get_interval('time', tz=object.partner_id.tz) or ''}
                                        </div>
                                % endif
                             </td>
                        </tr>
                    </table>
                    <p>Thank You.</p>
                    <p>
                        % if object.meeting_id.user_id and object.meeting_id.user_id.signature:
                            ${object.meeting_id.user_id.signature | safe}
                        % endif
                    </p>
                </div>
            </field>
            <field name="auto_delete" eval="False"/>
            <field name="user_signature" eval="False"/>
        </record>
        <record id="kw_meeting_calendar_template_meeting_dataupdate_external" model="mail.template">
            <field name="name">Calendar: Data updated</field>
            <field name="model_id" ref="kw_meeting_schedule.model_kw_meeting_external_participants"/>
            <field name="subject">${('Meeting Cancelled' if object.meeting_id.state == 'cancelled' else 'Meeting Information Modified')} for ${object.meeting_id.name} scheduled by ${object.meeting_id.user_id.name} </field>
            <field name="email_from">${object.create_uid.email}</field>
            <field name="email_to" >${('' if object.partner_id and object.partner_id.email and object.partner_id.email==object.email else object.email|safe)}</field>
            <field name="partner_to">${object.partner_id and object.partner_id.email and object.partner_id.email==object.email and object.partner_id.id or False }</field>
            <field name="lang">${object.partner_id.lang}</field>
            <field name="body_html" type="html">
                    <div>
                        % set colors = {'needsAction': 'grey', 'accepted': 'green', 'tentative': '#FFFF00',  'declined': 'red'}
                        <p>Hello ${object.partner_id.name},</p>
                        <p>
                            % if object.meeting_id.state == 'cancelled':
                                The meeting ${object.meeting_id.name} created by ${object.meeting_id.user_id.partner_id.name} scheduled
                                for ${object.meeting_id.get_display_time_tz(tz=object.partner_id.tz)} has been cancelled.
                                Please click on below view button to view meeting details.
                                <br/>
                                Reason of Cancellation: ${object.meeting_id.meeting_cancel_reason}
                            % else:
                                Few information of the meeting have been updated for ${object.meeting_id.name} created
                                by ${object.meeting_id.user_id.partner_id.name} scheduled for ${object.meeting_id.get_display_time_tz(tz=object.partner_id.tz)}.
                                Please click on below view button to view meeting details.
                            % endif   

                        </p>
                        <div style="text-align: center; margin: 16px 0px 16px 0px;">

                         % if object.meeting_id.state != 'cancelled':
                            <a href="/meeting_schedule/meeting/accept?db=${'dbname' in ctx and ctx['dbname'] or ''}&amp;token=${object.access_token}&amp;action=${'action_id' in ctx and ctx['action_id'] or ''}&amp;id=${object.meeting_id.id}" 
                                style="padding: 5px 10px; color: #FFFFFF; text-decoration: none; background-color: #875A7B; border: 1px solid #875A7B; border-radius: 3px">
                                Accept</a>
                            <a href="/meeting_schedule/meeting/decline?db=${'dbname' in ctx and ctx['dbname'] or '' }&amp;token=${object.access_token}&amp;action=${'action_id' in ctx and ctx['action_id'] or ''}&amp;id=${object.meeting_id.id}" 
                                style="padding: 5px 10px; color: #FFFFFF; text-decoration: none; background-color: #875A7B; border: 1px solid #875A7B; border-radius: 3px">
                                Decline</a>

                         % endif    
                            <a href="/meeting_schedule/meeting/view?db=${'dbname' in ctx and ctx['dbname'] or ''}&amp;token=${object.access_token}&amp;action=${'action_id' in ctx and ctx['action_id'] or ''}&amp;id=${object.meeting_id.id}" 
                                style="padding: 5px 10px; color: #FFFFFF; text-decoration: none; background-color: #875A7B; border: 1px solid #875A7B; border-radius: 3px">
                                View</a>
                        </div>
                     <table border="0" cellpadding="0" cellspacing="0" style="width:100%">
                        <tr style="width:100%;">
                            <td style="width:70%">
                                <p><strong>Meeting Details: </strong></p>
                                <table border="0" cellpadding="5" cellspacing="0">
                                    % if object.meeting_id.meeting_room_id:
                                          <tr>
                                              <td>Meeting Room</td>
                                              <td>:</td>
                                              <td> <span style="margin-left:5px">${object.meeting_id.meeting_room_id.name}(${object.meeting_id.meeting_room_id.floor_name})</span></td>
                                          </tr>
                                    % endif
                                   
                                    % if object.meeting_id.agenda_ids:
                                      <tr>
                                          <td style="width: 30%;vertical-align:top;">Agenda</td>
                                          <td style="width: 5%;vertical-align:top;">:</td>
                                          <td style="width: 65%">
                                            % for agenda in object.meeting_id.agenda_ids:
                                                 <li>
                                                    <span style="margin-left:5px">${agenda.name}</span>
                                                </li>
                                            % endfor
                                          </td>
                                      </tr>
                                    % endif
                                    
                                    % if object.meeting_id.description:
                                      <tr>
                                          <td style="width: 30%">Required Information</td>
                                          <td style="width: 5%">:</td>
                                          <td style="width: 65%">
                                               % if object.meeting_id.description:
                                              <span style="margin-left:5px"> ${object.meeting_id.description}</span>
                                                % endif
                                          </td>
                                      </tr>
                                    % endif
                                    
                                    % if object.meeting_id.recurrency:
                                      <tr>
                                          <td style="width: 30%;vertical-align:top;">Meeting Type: </td>
                                          <td style="width: 5%;vertical-align:top;">:</td>
                                          <td style="width: 65%">
                                                % for recurring_event in object.meeting_id.child_ids:
                                                        <div style="margin-left:5px;margin-bottom:5px;">${recurring_event.display_time}</div>
                                                % endfor
                                          </td>
                                      </tr>
                                    % endif
                                    
                                    % if not object.meeting_id.allday and object.meeting_id.duration:
                                      <tr>
                                          <td style="width: 30%">Duration</td>
                                          <td style="width: 5%">:</td>
                                          <td style="width: 65%">
                                              <span style="margin-left:5px"> ${('%dH:%dM' % (object.meeting_id.duration,(object.meeting_id.duration*60)%60))}</span>
                                          </td>
                                      </tr>
                                     % endif
                                     
                                     % if object.meeting_id.mom_required:
                                      <tr>
                                          <td style="width: 30%">MOM Controller</td>
                                          <td style="width: 5%">:
                                          </td>
                                          <td style="width: 65%">
                                              <span style="margin-left:5px">${object.meeting_id.mom_controller_id.name}</span>
                                          </td>
                                      </tr>
                                    % endif
                                      <tr t-if="object.meeting_id.attendee_ids">
                                          <td style="width: 30%;vertical-align:top;">Attendees</td>
                                          <td  style="width: 5%;vertical-align:top;">:</td>
                                          <td  style="width: 65%">
                                             % for attendee in object.meeting_id.attendee_ids:
                                                
                                                % if attendee.is_external == False:
                                                        <div style="margin-left:5px;margin-bottom:5px">${loop.index}.${attendee.common_name}</div>
                                                
                                                % endif
                                            % endfor
                                          </td>
                                      </tr>
                                    % if object.meeting_id.external_attendee_ids:
                                      <tr>
                                          <td style="width: 30%;vertical-align:top;"> External Participants</td>
                                          <td style="width: 5%;vertical-align:top;">:</td>
                                          <td style="width: 65%">
                                             % for ext_attendee in object.meeting_id.external_attendee_ids:
                                                    <div style="margin-left:5px;margin-bottom:5px;">${loop.index}.${ext_attendee.partner_id.name} ${ext_attendee.partner_id.mobile_no}</div>
                                            % endfor
                                          </td>
                                      </tr>
                                     % endif
                                     % if object.meeting_id.mpin:
                                      <tr>
                                          <td style="width: 30%;vertical-align:top;"> Mpin</td>
                                          <td style="width: 5%;vertical-align:top;">:</td>
                                          <td style="width: 65%">
                                            <div style="margin-left:5px;margin-bottom:5px;">${object.meeting_id.mpin}</div>
                                          </td>
                                      </tr>
                                     % endif
                                </table>
                            </td>
                             <td style="width:30%">
                                % if not object.meeting_id.recurrency:
                                        <div style="border-top-left-radius: 3px; border-top-right-radius: 3px; font-size: 12px; border-collapse: separate; text-align: center; font-weight: bold; color: #ffffff; min-height: 18px; background-color: #875A7B; border: 1px solid #875A7B;">
                                            ${object.meeting_id.get_interval('dayname', tz=object.partner_id.tz if not object.meeting_id.allday else None)}
                                        </div>
                                        <div style="font-size: 48px; min-height: auto; font-weight: bold; text-align: center; color: #5F5F5F; background-color: #F8F8F8; border: 1px solid #875A7B;">
                                            ${object.meeting_id.get_interval('day', tz=object.partner_id.tz if not object.meeting_id.allday else None)}
                                        </div>
                                        <div style='font-size: 12px; text-align: center; font-weight: bold; color: #ffffff; background-color: #875A7B;'>
                                            ${object.meeting_id.get_interval('month', tz=object.partner_id.tz if not object.meeting_id.allday else None)}
                                        </div>
                                        <div style="border-collapse: separate; color: #5F5F5F; text-align: center; font-size: 12px; border-bottom-right-radius: 3px; font-weight: bold; border: 1px solid #875A7B; border-bottom-left-radius: 3px;">
                                            ${not object.meeting_id.allday and object.meeting_id.get_interval('time', tz=object.partner_id.tz) or ''}
                                        </div>
                                % endif
                             </td>
                        </tr>
                    </table>
                        <p>Thank You.</p>
                        <p>
                            % if object.meeting_id.user_id and object.meeting_id.user_id.signature:
                                ${object.meeting_id.user_id.signature | safe}
                            % endif
                        </p>
                    </div>
            </field>
            <field name="auto_delete" eval="False"/>
            <field name="user_signature" eval="False"/>
        </record>
    </data>
</odoo>
