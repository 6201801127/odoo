<odoo>
    <data>
        <!-- Apply Local Visit list view -->
        <record model="ir.ui.view" id="kw_lv_apply_list">
            <field name="name">Apply Local Visit</field>
            <field name="model">kw_lv_apply</field>
            <field name="arch" type="xml">
                <tree string="Local Visit Apply Form" import='false'>
                    <field name="applied_by"/>
                    <field name="emp_name" string='Employee Name'/>
                    <field name="visit_category"/>
                    <field name="visit_date"/>
                    <field name="location" invisible='1'/>
                    <field name="expected_in_time"/>
                    <field name="out_time"/>
                    <field name="status" invisible='1'/>
                    <field name="check_is_user" invisible='1'/>
                    <field name="state" invisible='1'/>
                    <field name="settlement_required" invisible='1'/>
                    <field name="vehicle_type" invisible='1'/>
                    <field name="auto_calculation" invisible='1'/>
                    <button class="btn btn-success" string='Office In' name="change_ofc_in" type="object" attrs="{'invisible': ['|',('status','in',['office_in',False]),('check_is_user','=',False)]}"/>
                    <field name="ra_access" invisible="1"/>
                    <field name="visit_details" invisible="1"/>
                    <field name="business_ids" invisible="1"/>
                    <!-- <field name="date_month"/> -->
                </tree>
            </field>
        </record>

        <!-- Apply Local Visit form view -->
        <record model="ir.ui.view" id="kw_lv_apply_form">
            <field name="name">Apply Local Visit</field>
            <field name="model">kw_lv_apply</field>
            <field name="arch" type="xml">
                <form string="Local Visit Apply Form" duplicate='0' import='false'>
                    <field name="ra_access" invisible="1"/>
                    <field name="status" invisible="1"/>
                    <field name="stage_id" invisible="1"/>
                    <field name="office_details" invisible='1'/>
                    <field name="visit_details" invisible="1"/>
                    <field name="apply_future_date" invisible="1"/>
                    <field name="apply_back_date" invisible="1"/>
                    <field name="check_back_date" invisible='1'/>
                    <field name="branch_id" invisible='1'/>
                    <field name="vehicle_filter" invisible='1'/>
                    <field name="compute_price" invisible='1'/>
                    <sheet>
                        <group>
                            <group>
                                <field name="lv_for" widget="radio" options="{'horizontal': true}" attrs="{'readonly': [('status','in',['office_out','office_in'])]}"/>
                                <field name="emp_name" attrs="{'invisible': [('lv_for','=','self')],'readonly': [('status','in',['office_out','office_in'])]}" string='Apply For' domain='[("parent_id.user_id","in",[uid])]' options="{'no_open': True,'no_create':True,'no_edit':True}"/>

                                <field name="visit_category" options="{'no_open': True,'no_create':True,'no_edit':True}" attrs="{'readonly': [('status','in',['office_out','office_in'])]}"/>
                                <field name="business_ids" attrs="{'invisible':[('visit_details', 'in',['no',False])],'readonly': [('status','in',['office_out','office_in'])]}" context="{'category_id':visit_category}">
                                    <tree>
                                        <field name="activity_name"/>
                                        <field name="sub_category"/>
                                        <field name="visit_for"/>
                                        <field name="crm_id"/>
                                    </tree>
                                </field>
                                <field name="location" attrs="{'invisible':[('visit_details', '=', 'yes')], 'readonly': [('status','in',['office_out','office_in'])],'required': [('visit_details','in',['no'])]}"/>

                                <field name="organization_name" options="{'no_create':True,'no_open': True,'no_edit':True}" domain="[('partner_share', '=', True),('is_company', '=', True)]" context="{'form_view_ref': 'kw_local_visit.kw_lv_inherited_res_partner_form','default_customer': False,'default_supplier': False, 'default_is_company': True}" attrs="{'invisible': ['|',('visit_details', '=', 'yes'),('office_details','in',['no',False])], 'readonly': [('status','in',['office_out','office_in'])]}"/>

                                <field name="contact_person" options="{'no_create':True,'no_open': True,'no_edit':True}" domain="[('partner_share', '=', True),('is_company', '=', False),('parent_id', '=', organization_name)]" context="{'form_view_ref': 'kw_local_visit.kw_lv_inherited_res_partner_form','default_customer': False,'default_supplier': False,'default_is_company': False,'related_company':organization_name,'partner_name':1}" attrs="{'invisible': ['|','|',('organization_name', '=', False),('visit_details', '=', 'yes'),('office_details','in',['no',False])], 'readonly': [('status','in',['office_out','office_in'])]}"/>

                                <field name="purpose" attrs="{'invisible':[('visit_details', '=', 'yes')], 'readonly': [('status','in',['office_out','office_in'])],'required': [('visit_details','in',['no'])]}"/>
                            </group>
                            <group>
                                <field name="visit_date" attrs="{'invisible': [('apply_future_date','in',[False,'no']),('apply_back_date','in',[False,'no'])],'readonly': [('status','in',['office_out','office_in'])]}"/>
                                <field name="expected_in_time" attrs="{'readonly': [('status','in',['office_out','office_in'])]}"/>
                                <field name="out_time" attrs="{'readonly': [('status','in',['office_out','office_in'])],'invisible': ['|',('apply_back_date','=','no'),('check_back_date','=',False)]}" />
                                <field name="vehicle_arrange" widget="radio" options="{'horizontal': true}" attrs="{'readonly': [('status','in',['office_out','office_in'])]}"/>
                                <field name="vehicle_type" options="{'no_open': True,'no_create':True,'no_edit':True}" attrs="{'readonly': [('status','in',['office_out','office_in'])],'invisible': [('vehicle_arrange','in',[False,'own']),('office_details','in',[False,'no'])]}" domain="[('location','=',branch_id),('settlement_required','=',vehicle_filter)]"/>
                                <field name="vehicle_out_time" attrs="{'invisible': [('vehicle_arrange','=','own')],'required':[('vehicle_arrange','=','office')],'readonly': [('status','in',['office_out','office_in'])]}"/>
                                <field name="vehicle_in_time" attrs="{'invisible': [('vehicle_arrange','=','own')],'required':[('vehicle_arrange','=','office')],'readonly': [('status','in',['office_out','office_in'])]}"/>
                                <field name="intimate_to" domain="[('id','!=',emp_name)]" context="{'tree_view_ref': 'kw_local_visit.hr_employee_local_visit_tree_view'}" options="{'no_open': True,'no_create':True,'no_edit':True}" attrs="{'readonly': [('status','in',['office_out','office_in'])]}"/>
                            </group>
                            <group attrs="{'invisible': [('office_details','in',[False,'no']),('vehicle_arrange','=','own')]}">
                                <field name="visiting_with" widget="radio" options="{'horizontal': true}" attrs="{'readonly': [('status','in',['office_out','office_in'])],'invisible': [('office_details','=','no')]}"/>
                                <field widget='many2many_tags' name="visiting_group" attrs="{'readonly': [('status','in',['office_out','office_in'])],'invisible': ['|',('visiting_with','=','individual'),('office_details','=','no')]}" options="{'no_open': True,'no_create':True,'no_edit':True}" context="{'tree_view_ref': 'kw_local_visit.hr_employee_local_visit_tree_view'}" domain="[('id','not in',[emp_name,intimate_to])]"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="kw_lv_apply_kanban">
            <field name="name">Local visit apply kanban</field>
            <field name="model">kw_lv_apply</field>
            <field name="arch" type="xml">
                <kanban edit='false' import='false' class='oe_background_grey o_kanban_dashboard o_project_kanban o_emphasize_colors' quick_create="false" group_create='false' group_edit='false' group_delete='false'>
                    <field name="applied_by"/>
                    <field name="emp_name"/>
                    <field name="visit_category"/>
                    <field name="visit_date"/>
                    <field name="location"/>
                    <field name="expected_in_time"/>
                    <field name="out_time"/>
                    <field name="status"/>
                    <field name="state"/>
                    <field name="vehicle_type"/>
                    <field name="business_ids"/>
                    <field name="color"/>
                    <field name="visit_details"/>
                    <field name="lv_for"/>
                    <field name="check_is_user"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="#{kanban_color(record.color.raw_value)} oe_kanban_global_click">
                                <div class="o_dropdown_kanban dropdown">
                                    <a class="dropdown-toggle o-no-caret btn" role="button" data-toggle="dropdown" data-display="static" href="#" aria-label="Dropdown menu" title="Dropdown menu">
                                        <span class="fa fa-ellipsis-v"/>
                                    </a>
                                    <div class="dropdown-menu" role="menu">
                                        <t t-if="widget.editable">
                                            <a role="menuitem" type="edit" class="dropdown-item">
                                                <i class="fa fa-external-link" />
 Edit</a>
                                        </t>
                                        <t t-if="widget.deletable">
                                            <a role="menuitem" type="delete" class="dropdown-item">
                                                <i class="fa fa-trash-o" />
 Delete</a>
                                        </t>
                                        <ul class="oe_kanban_colorpicker" data-field="color"/>
                                    </div>
                                </div>
                                <div class="o_kanban_record_top container p-2 m-0">
                                    <div class="o_kanban_record_headings">
                                        <div class="text-left">
                                            <h3 class="text-uppercase">
                                                <field name="emp_name"/>
                                            </h3>
                                            <h3 class="text-uppercase badge badge-warning text-wrap font-weight-bold" style="font-size: 1rem;">
                                                <field name="visit_category"/>
                                            </h3>
                                            <div class="clearfix"/>
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <h6>
                                                        <i class="font-weight-bold fa fa-user"/>
                                                        <b> Applied By : </b>
                                                        <t t-if='record.lv_for.raw_value == "others"'>
                                                            <field name="applied_by" />
                                                        </t>
                                                        <t t-else=''>
                                                            <field name="lv_for" />
                                                        </t>
                                                    </h6>
                                                    <h6>
                                                        <i class="font-weight-bold fa fa-calendar-o"/>
                                                        <b> Visit Date : </b>
                                                        <field name="visit_date" widget="date"/>
                                                    </h6>
                                                    <h6>
                                                        <i class="font-weight-bold fa fa-clock-o"/>
                                                        <b> Expected In Time : </b>
                                                        <field name="expected_in_time"/>
                                                    </h6>
                                                    <h6>
                                                        <i class="font-weight-bold fa fa-clock-o"/>
                                                        <b> Out Time : </b>
                                                        <field name="out_time"/>
                                                    </h6>
                                                </div>
                                            </div>
                                            <div class="o_kanban_record_bottom mt-2">
                                                <div class="oe_kanban_bottom_left">
                                                    <button class="btn btn-success text-uppercase font-weight-bold" name="change_ofc_in" type="object" attrs="{'invisible': ['|',('status','in',['office_in',False]),('check_is_user','=',False)]}">Office In</button>
                                                </div>
                                                <div class="oe_kanban_bottom_right">
                                                    <img t-att-src="kanban_image('hr.employee', 'image_small', record.emp_name.raw_value)" t-att-title="record.emp_name.value" t-att-alt="record.emp_name.value" width="30" height="30" class="oe_kanban_avatar"/>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="kw_lv_apply_search" model="ir.ui.view">
            <field name="name">Apply Local Visit</field>
            <field name="model">kw_lv_apply</field>
            <field name="arch" type="xml">
                <search>
                    <!-- FILTER -->
                    <filter string="Visit Date" name="visit_date" date="visit_date"/>
                    <separator/>
                    <!-- SEARCH -->
                    <field name="emp_name"/>
                    <separator/>
                    <field name="applied_by"/>
                    <!-- GROUP BY -->
                    <group expand="0" string="Group By">
                        <filter string="Visit Status" name="visit_status" context="{'group_by':'status'}"/>
                        <filter string="Visit Category" name="visit_category" context="{'group_by':'visit_category'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Apply Local Visit actions window -->
        <record model="ir.actions.act_window" id="kw_lv_apply_action_window">
            <field name="name">Apply Local Visit</field>
            <field name="res_model">kw_lv_apply</field>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="domain">['&amp;',('status','in',['office_out',False]),'|',('emp_name.user_id','=',uid),('emp_name.parent_id.user_id','=',uid)]</field>
            <field name="search_view_id" ref="kw_lv_apply_search"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No local visit(s) Here...
                </p>
            </field>
        </record>

        <record id="action_kw_lv_apply_act_window_view_tree" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="kw_lv_apply_list"/>
            <field name="act_window_id" ref="kw_lv_apply_action_window"/>
        </record>

        <record id="action_kw_lv_apply_act_window_view_form" model="ir.actions.act_window.view">
            <field eval="3" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="kw_lv_apply_form"/>
            <field name="act_window_id" ref="kw_lv_apply_action_window"/>
        </record>

        <record id="action_kw_lv_apply_act_window_view_kanban" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">kanban</field>
            <field name="view_id" ref="kw_lv_apply_kanban"/>
            <field name="act_window_id" ref="kw_lv_apply_action_window"/>
        </record>

        <record model="ir.ui.view" id="kw_lv_apply_default_list">
            <field name="name">Apply Local Visit</field>
            <field name="model">kw_lv_apply</field>
            <field name="priority" eval="0"/>
            <field name="arch" type="xml">
                <tree string="Local Visit Apply Form">
                    <field name="emp_name"/>
                    <field name="visit_category"/>
                    <field name="visit_date"/>
                    <field name="out_time"/>
                    <field name="actual_in_time"/>
                    <field name="state" invisible='1'/>
                </tree>
            </field>
        </record>


    </data>
</odoo>