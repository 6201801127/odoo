<?xml version="1.0"?>
<odoo>
    <data>
    <!-- Material Request -->
        <record id="kw_materail_request_take_action_view_tree" model="ir.ui.view">
            <field name="name">kw_material_management.view.takeaction.tree</field>
            <field name="model">kw_material_management</field>
            <field name="arch" type="xml">
                <tree default_order="id desc" create='0' delete='0' import='0' decoration-info="(state == 'Issued')" decoration-danger="(state in ['Rejected','Cancelled'])" decoration-success="(state == 'Approved')" >
                    <field name="item_sequence" string="Material Ref." />
                    <field name="employee_id" string="Employee" />
                    <field name="department_id" string="Department" />
                    <!-- <field name="dept_code" string="Department Code" /> -->
                    <field name="date" string="Applied Date" />
                    <field name="pending_at" string="Pending At" />
                    <field name="state" string="Status"/>
                </tree>
            </field>
        </record>

        <record id="kw_materail_request_take_action_manager_form" model="ir.ui.view">
            <field name="name">kw_material_management.view.manager.form</field>
            <field name="model">kw_material_management</field>
            <field name="priority">18</field>
            <field name="arch" type="xml">
                <form string="" duplicate="0" create='0' delete='0'>
                    <header>
                       <button name="redirect_hod_action" context='{"submit_hod_approve":True}' attrs="{'invisible': [('state', 'in', ['Approved','Rejected'])]}" string="Approve" type="object" class="btn btn-success" />
                        <button name="redirect_hod_action" context='{"submit_hod_reject":True}' attrs="{'invisible': [('state', 'in', ['Approved','Rejected'])]}" string="Reject" type="object" class="btn btn-danger" />
                        <field name="state" widget="statusbar" statusbar_visible="Draft,Approved,Issued,Rejected" readonly="1"/>
                    </header>
                    <sheet>
                        <style>
                            .table-responsive .o_list_view thead tr:nth-child(1) th{
                                background-color: #108fbb !important;
                                color: whitesmoke;
                            }
                        </style>
                        <group>
                            <group>
                                <field name="item_sequence" string="Material Ref." />
                                <field name="employee_id" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True,}" readonly='1'/>
                                <field name="department_id" string="Department" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True,}" readonly='1'/>
                                <field name="division_id" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True,}" readonly='1'/>
                                <field name="section_id" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True,}" readonly='1'/>
                                <field name="practice_id" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True,}" readonly='1'/>
                            </group>
                            <group>
                                <field name="date" string="Applied Date" attrs="{'readonly': [('state', 'not in', ['Draft'])]}"/>
                                <!-- <field name="dept_code" string="Department Code" readonly='1'/> -->
                                <field name="requirement_type" string="Requirement Type" required='1' attrs="{'readonly': [('state', 'in', ['cancelled','Approved','Rejected'])]}"/>
                                <field name="project_code" attrs="{'required': [('requirement_type', '=','project')],'invisible': [('requirement_type', '!=','project')],'readonly': [('state', 'in', ['cancelled','Approved','Rejected'])]}"/>
                                <field name="branch_id" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True,}" readonly='1'/>                                
                            </group>
                            <h1 class="my-3"> Item Details </h1>
                            <field name="add_product_items_ids" string="Item Details" context="{'form_view_ref' : 'kw_inventory.kw_material_management_view_form'}" readonly='0'>
                                <tree editable="bottom"  create='0' edit='1' delete='0' decoration-danger="(status == 'Rejected')">
                                    <field name="product_type" string="Product Category" readonly='1'/>
                                    <!-- <field name="product_category" string=" Product Category"/> -->
                                    <field name="product_template_id" string="Product Type" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True,}" readonly='1'/>
                                    <field name="item_code" string="Item Code" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True,}" readonly='1'/>
                                    <field name="item_description" string="Item Description" invisible='1' style="pointer-events:none;" readonly='1'/>
                                    <field name="quantity_required" string="Quantity Required" attrs="{'readonly': [('status', '=','approved')]}"/>
                                    <field name="uom" string="UoM" style="pointer-events:none;" readonly='1'/>
                                    <field name="expected_days" string="Required Date" readonly='1'/>
                                    <!-- <field name="check_availability" readonly="1" /> -->
                                    <field name="employee_id" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True,}" string='Issue to' readonly='1'/>
                                    <field name="status" string="Status" readonly='1'/>
                                    <!-- <button name="redirect_reject_item" attrs="{'invisible': ['|','|',('status', '=', 'Approved'),('status','=','Rejected'),('status','=','Hold')]}" string="Reject" type="object" class="btn btn-danger"/> -->
                               
                                </tree>
                            </field>
                            <h1 class="my-3"> Action Log </h1>
                            <field name="material_log" string="Action Log" force_save='1' style="pointer-events:none;"/>
                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                        <field name="activity_ids" widget="mail_activity"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="kw_materail_request_sbu_view_search" model="ir.ui.view">
            <field name="name">kw_material_management.search</field>
            <field name="model">kw_material_management</field>
            <field name="arch" type="xml">

                <search string="">
                    <field string="Material Ref" name="item_sequence"/>
                    <field string="Employee" name="employee_id" />
                    <field string="Department" name="department_id" />
                    <field string="Division" name="division_id" />
                    <field string="Section" name="section_id"/>
                    <field string="Practice" name="practice_id" />
                    <field string="Branch" name="branch_id" />
                    <field string="Applied Date" name="date" />
                    <!-- <field string="Department Code" name="dept_code" /> -->
                    <field string="Project Code" name="project_code"/>
                    <field string="State" name="state"/>


                    <filter string="Pending" name="pending" domain="[('state', '=','Pending')]"/>


                    <group expand="0" string="Group By">
                        <filter string="State" name="grp_by_state" domain="" context="{'group_by':'state'}"/>
                        <filter string="Branch" name="grp_by_branch_id" domain="" context="{'group_by':'branch_id'}"/>
                        <filter string="Department" name="grp_by_department_id" domain="" context="{'group_by':'department_id'}"/>
                        <filter string="Division" name="grp_by_division_id" domain="" context="{'group_by':'division_id'}"/>
                        <filter string="Section" name="grp_by_section_id" domain="" context="{'group_by':'section_id'}"/>
                    </group>
                </search>
            </field>
        </record>
    
    
        <record id="kw_material_request_take_action_window" model="ir.actions.act_window">
            <field name="name">Pending Actions</field>
            <field name="res_model">kw_material_management</field>
            <field name="view_mode">tree,form</field>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('kw_materail_request_take_action_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('kw_materail_request_take_action_manager_form')})]"/>
            <field name="search_view_id" ref='kw_inventory.kw_materail_request_sbu_view_search'/>
            <field name="context">{'search_default_grp_by_state':1,'hod_action_material_management':True}</field>
            <field name="domain">[('department_id.manager_id.user_id','=',uid),('state','in',['Pending'])]</field>
        </record>

        <!-- <menuitem
            id="menu_material_request_take_action"
            sequence="2"
            name="Pending Actions"
            parent="kw_material_request_process"
            action="kw_material_request_take_action_window"/> -->
    

    </data>
</odoo>
