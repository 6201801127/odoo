function _elk_DS(){function e(){for(;_elk_send_queue.length>0&&0==_elk_desksignObj._elk_socket.bufferedAmount;){var t=_elk_send_queue[0];_elk_send_queue.shift(),_elk_desksignObj._elk_socket.send(t)}_elk_send_queue.length>0&&_elk_desksignObj._elk_socket.bufferedAmount>0?window.setTimeout(e,5):_elk_enablePage()}_elk_DSObjCount>0?alert("Cannot create object of type _elk_DS more than once"):(_elk_DSObjCount++,this._elk_initialized=!1,this.bActiveX=!1,this.activeXObj=null,this._elk_socket=null,this._elk_connectionOpen=!1,this._elk_userCallback,this._elk_setCallback=function(e){if(void 0!==this._elk_socket&&null!=this._elk_socket)try{this._elk_socket.onmessage=function(t){var i=JSON.parse(t.data);e(i.resp,i.status,i.params)}}catch(e){alert("Error:"+e)}},this._elk_open=function(){var e;if(void 0===this._elk_socket||null==this._elk_socket){try{var t;t=_elk_new_proto?"E-Lock-protocol2":"E-Lock-protocol",e=(document.URL.substring(0,5),"wss://127.0.0.1:7681/xxx"),"undefined"!=typeof MozWebSocket?this._elk_socket=new MozWebSocket(e,t):this._elk_socket=new WebSocket(e,t),this._elk_socket.onopen=_elk_onopenfn,this._elk_socket.onclose=_elk_onclosefn,this._elk_socket.onerror=_elk_onerrorfn}catch(e){_elk_enablePage(),this._elk_socket=null,_elk_switchToActiveX()}void 0!==this._elk_socket&&null!=this._elk_socket&&1==this._elk_socket.readyState?(_elk_enablePage(),this._elk_connectionOpen=!0):this._elk_connectionOpen=!1}},this._elk_close=function(){void 0!==this._elk_socket&&null!=this._elk_socket&&this._elk_socket.close(),this._elk_socket=null,this._elk_connectionOpen=!1},this._elk_start_app=function(){window.location="elk://"},this._elk_end_app=function(){try{void 0!==this._elk_socket&&null!=this._elk_socket&&this._elk_close()}catch(e){}},this._elk_initialize=function(e){_elk_detectBrowser(),_elk_createDiv(),_elk_disablePage(),this._elk_userCallback=e,this._elk_initialized=!0,_elk_desksignObj._elk_open(),_elk_desksignObj._elk_setCallback(_elk_desksignObj._elk_userCallback)},this._elk_uninitialize=function(){this._elk_end_app()},this._elk_check_connection=function(){if(0==this._elk_initialized)return alert("ERROR: Need to call _elk_desksignObj._elk_initialize before calling any Signing APIs. Do this on page load"),!1;if(void 0===this._elk_socket||null==this._elk_socket||!this._elk_connectionOpen){if(void 0!==this._elk_socket&&null!=this._elk_socket&&1==this._elk_socket.readyState)return _elk_enablePage(),this._elk_connectionOpen=!0,!0;if(void 0===this._elk_socket||null==this._elk_socket||!this._elk_connectionOpen)return alert("Could not connect to E-Lock SignApp.\n\n"+_elk_lastmsg),!1}return!0},this._elk_send_request=function(e){if(this._elk_check_connection())try{if(_elk_new_proto){var t,i=_elk_byteLength(e);t=bEdge||bIE?5e4:1e3;var n=0;for(e=_elk_round8(i)+e,i+=8;i>0;){if(!(i>t)){this._elk_buffered_send(e.substr(n));break}this._elk_buffered_send(e.substr(n,t)),n+=t,i-=t}}else this._elk_buffered_send(e)}catch(e){alert("Exception: "+e)}},this._elk_buffered_send=function(t){0==_elk_send_queue.length&&0==this._elk_socket.bufferedAmount?this._elk_socket.send(t):(_elk_send_queue.push(t),1==_elk_send_queue.length&&(_elk_disablePage(),window.setTimeout(e,5)))},this._elk_activeX_returnResult=function(e,t){var i,n={};if(this.bActiveX){var s;"SignFile"!=e&&"SignPDFInMemory"!=e?(s=this.activeXObj.GetOperationStatusString(),i=this.activeXObj.GetOperationStatusCode()):(s=e+" functionality is not supported in this mode of signing",i=-1),void 0!==t&&null!=t&&""!=t&&("GetSubjectDN"==e||"GetIssuerDN"==e?n.dn=t:"SignDataDetached"!=e&&"SignDataInMemoryEx"!=e&&"SignEncodedDataInBatch"!=e||(n.sig=t)),n.statusCode="0x"+i.toString(16),this._elk_userCallback(e,s,n)}},this.SetTSParameters=function(e,t,i,n,s){if(this.bActiveX)this.activeXObj.SetTSParameters(e,t,i,n,s),this._elk_activeX_returnResult("SetTSParameters","");else{var l='{"server-host-name":"'+e+'","server-port":'+t+',"server-url":"'+i+'","ts-before":'+n+',"policy-id":"'+s+'"}';this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"SetTSParameters","params":'+l+" }")}},this.SignPDFData=function(e,t,i,n,s,l,_,r,a,o,c,k,d,u){if(this.bActiveX)this.activeXObj.SignPDFData(e,t,i,n,s,l,_,r,a,o,c,k,d,u),this._elk_activeX_returnResult("SignPDFData","");else{var g='{"in-file":"'+(e=e.replace(/\\/g,"\\\\"))+'","out-file":"'+(t=t.replace(/\\/g,"\\\\"))+'","signing-time":'+i+',"store-type":'+n+',"issued-to":"'+s+'","issued-by":"'+l+'","pfx-file":"'+(_=_.replace(/\\/g,"\\\\"))+'","pwd":"'+r+'","silent-mode":'+a+',"reseller-code":'+c+',"signature-format":'+d+"}";this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"SignPDFData","params":'+g+" }")}},this.SignDataInMemoryEx=function(e,t,i,n,s,l,_,r,a,o,c,k){if(this.bActiveX)t=this.activeXObj.SignDataInMemoryEx(e,t,i,n,s,l,_,r,a,o,c,k),this._elk_activeX_returnResult("SignDataInMemoryEx",t);else{var d='{"data":"'+e+'","sig":"'+t+'","detached":'+i+',"signing-time":'+n+',"store-type":'+s+',"issued-to":"'+l+'","issued-by":"'+_+'","pfx-file":"'+(r=r.replace(/\\/g,"\\\\"))+'","pwd":"'+a+'","silent-mode":'+o+',"reseller-code":'+k+"}";this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"SignDataInMemoryEx","params":'+d+" }")}},this.SignEncodedDataInBatch=function(e,t,i,n,s,l,_,r,a,o,c){if(this.bActiveX)sig=this.activeXObj.SignEncodedDataInBatch(e,t,i,n,s,l,_,r,a,o,c),this._elk_activeX_returnResult("SignEncodedDataInBatch",sig);else{var k='{"data":"'+e+'","detached":'+t+',"signing-time":'+i+',"store-type":'+n+',"issued-to":"'+s+'","issued-by":"'+l+'","pfx-file":"'+(_=_.replace(/\\/g,"\\\\"))+'","pwd":"'+r+'","silent-mode":'+a+',"reseller-code":'+c+"}";this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"SignEncodedDataInBatch","params":'+k+" }")}},this.SignDataAttached=function(e,t,i,n,s,l,_,r,a,o,c){if(this.bActiveX)this.activeXObj.SignDataAttached(e,t,i,n,s,l,_,r,a,o,c),this._elk_activeX_returnResult("SignDataAttached","");else{var k='{"in-file":"'+(e=e.replace(/\\/g,"\\\\"))+'","out-file":"'+(c=c.replace(/\\/g,"\\\\"))+'","signing-time":'+t+',"store-type":'+i+',"issued-to":"'+n+'","issued-by":"'+s+'","pfx-file":"'+(l=l.replace(/\\/g,"\\\\"))+'","pwd":"'+_+'","silent-mode":'+r+',"reseller-code":'+o+"}";this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"SignDataAttached","params":'+k+" }")}},this.SignDataDetached=function(e,t,i,n,s,l,_,r,a,o,c,k,d){var u="";if(this.bActiveX)u=this.activeXObj.SignDataDetached(e,t,i,n,s,l,_,r,a,o,c,k,d),this._elk_activeX_returnResult("SignDataDetached",u);else{var g='{"in-file":"'+(e=e.replace(/\\/g,"\\\\"))+'","in-signature":"'+t+'","is-encoded":'+i+',"is-hash":'+n+',"signing-time":'+s+',"store-type":'+l+',"issued-to":"'+_+'","issued-by":"'+r+'","pfx-file":"'+(a=a.replace(/\\/g,"\\\\"))+'","pwd":"'+o+'","silent-mode":'+c+',"reseller-code":'+d+"}";this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"SignDataDetached","params":'+g+" }")}},this.ConfigSigBlock=function(e,t,i,n,s,l,_,r){if(this.bActiveX)this.activeXObj.ConfigSigBlock(e,t,i,n,s,l,_,r),this._elk_activeX_returnResult("ConfigSigBlock","");else{var a='{"elements":'+e+',"width":'+t+',"height":'+i+',"image-position":'+n+',"orientation":'+s+',"sig-text":"'+l+'","x-margin":'+_+',"y-margin":'+r+"}";this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"ConfigSigBlock","params":'+a+" }")}},this.EnablePDFArchivalSignature=function(e){if(this.bActiveX)this.activeXObj.EnablePDFArchivalSignature(e),this._elk_activeX_returnResult("EnablePDFArchivalSignature","");else{var t='{"enable":'+e+"}";this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"EnablePDFArchivalSignature","params":'+t+" }")}},this.DoValidationBeforeSigningEx=function(e,t,i,n){if(this.bActiveX)this.activeXObj.DoValidationBeforeSigningEx(e,t,i,n),this._elk_activeX_returnResult("DoValidationBeforeSigningEx","");else{var s;null==e?s="[]":dns=JSON.stringify(e);var l='{"trusted-root-dns":'+s+',"do-rev-checking":'+t+',"ignore-validation-res":'+i+',"reseller-code":'+n+"}";this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"DoValidationBeforeSigningEx","params":'+l+" }")}},this.SetSigningParametersEx=function(e,t,i,n){if(void 0===t&&(t=""),void 0===i&&(i=""),void 0===n&&(n=""),this.bActiveX)this.activeXObj.SetSigningParametersEx(e,t,i,n),this._elk_activeX_returnResult("SetSigningParametersEx","");else{var s='{"reason":"'+e+'","location":"'+t+'","signing-provider":"'+i+'","hash-algorithm":"'+n+'"}';this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"SetSigningParametersEx","params":'+s+" }")}},this.SetSigAppearanceParam=function(e,t,i){if(this.bActiveX)this.activeXObj.SetSigAppearanceParam(e,t,i),this._elk_activeX_returnResult("SetSigAppearanceParam","");else{var n='{"visibility-position":'+e+',"page-position":'+t+',"image-path":"'+(i=i.replace(/\\/g,"\\\\"))+'"}';this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"SetSigAppearanceParam","params":'+n+" }")}},this.EnableExpiredCertEnumeration=function(e){if(this.bActiveX)this.activeXObj.EnableExpiredCertEnumeration(e),this._elk_activeX_returnResult("EnableExpiredCertEnumeration","");else{var t='{"enable":'+e+"}";this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"EnableExpiredCertEnumeration","params":'+t+" }")}},this.GetSubjectDN=function(){var e="";if(this.bActiveX)e=this.activeXObj.GetSubjectDN(),this._elk_activeX_returnResult("GetSubjectDN",e);else{this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"GetSubjectDN","params":{} }')}},this.GetIssuerDN=function(){var e="";if(this.bActiveX)e=this.activeXObj.GetIssuerDN(),this._elk_activeX_returnResult("GetIssuerDN",e);else{this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"GetIssuerDN","params":{} }')}},this.SignFile=function(e,t,i,n,s,l,_,r,a){if(void 0!==a&&0==a||(a=!0),this.bActiveX)alert("SignFile functionality is not supported in this mode of signing"),this._elk_activeX_returnResult("SignFile","");else{var o='{"file-to-sign":"'+(e=e.replace(/\\/g,"\\\\"))+'","signing-time":'+t+',"store-type":'+i+',"issued-to":"'+n+'","issued-by":"'+s+'","pfx-file":"'+(l=l.replace(/\\/g,"\\\\"))+'","pwd":"'+_+'","reseller-code":'+r+',"get-sig":'+a+"}";this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"SignFile","params":'+o+" }")}},this.SignPDFInMemory=function(e,t,i,n,s,l,_,r,a,o){if(void 0===a?(o=r,a=1,r=!1):void 0===o&&(o=a,a=1),this.bActiveX)alert("SignPDFInMemory functionality is not supported in this mode of signing"),this._elk_activeX_returnResult("SignPDFInMemory","");else{var c='{"pdf-data":"'+e+'","signing-time":'+t+',"store-type":'+i+',"issued-to":"'+n+'","issued-by":"'+s+'","pfx-file":"'+(l=l.replace(/\\/g,"\\\\"))+'","pwd":"'+_+'","silent-mode":'+r+',"reseller-code":'+o+',"signature-format":'+a+"}";this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"SignPDFInMemory","params":'+c+" }")}},this.GetCurrentVersion=function(){if(this.bActiveX)alert("GetCurrentVersion functionality is not supported in this mode of signing"),this._elk_activeX_returnResult("GetCurrentVersion","");else{this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"GetCurrentVersion","params":{} }')}},this.SetUpdateInfoURL=function(e){if(this.bActiveX)alert("SetUpdateInfoURL functionality is not supported in this mode of signing"),this._elk_activeX_returnResult("SetUpdateInfoURL","");else{var t='{"update-info-url":"'+e+'"}';this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"SetUpdateInfoURL","params":'+t+" }")}},this.GetSignerCertDetails=function(){if(this.bActiveX)alert("GetSignerCertDetails functionality is not supported in this mode of signing"),this._elk_activeX_returnResult("GetSignerCertDetails","");else{this._elk_send_request('{ "msg":"sign","ver":0,"cmd":"GetSignerCertDetails","params":{} }')}})}function _elk_switchToActiveX(){var e="Your browser neither supports Websockets nor ActiveX plugins. Please upgrade your browser version or use a different browser";if(!_elk_desksignObj.bActiveX&&0==_elk_desksignObj._elk_connectionOpen)if(bIE||bFirefox){var t=document.createElement("div");if(t.innerHTML='<object id="pluginSign" type="application/x-ELOCK-Plugin-For-Desk-Sign" height="0" width="0"></object>',document.body.appendChild(t),_elk_desksignObj.activeXObj=document.getElementById("pluginSign"),void 0===_elk_desksignObj.activeXObj||null==_elk_desksignObj.activeXObj)return void _elk_savealert("Error: "+e);try{_elk_desksignObj.activeXObj.GetOperationStatusString()}catch(t){return void _elk_savealert("Error: "+e)}_elk_desksignObj.bActiveX=!0}else _elk_savealert("Error in loading E-Lock Signing component for this browser. Please use Internet Explorer or Firefox")}function _elk_savealert(e){_elk_lastmsg=e}function _elk_onopenfn(){_elk_enablePage(),_elk_desksignObj._elk_connectionOpen=!0}function _elk_onclosefn(){_elk_desksignObj._elk_connectionOpen=!1,_elk_desksignObj._elk_socket=null,_elk_new_proto&&_elk_err_try?(_elk_new_proto=!1,_elk_err_try=!1,_elk_desksignObj._elk_socket=null,_elk_desksignObj._elk_open(),_elk_desksignObj._elk_setCallback(_elk_desksignObj._elk_userCallback)):(_elk_enablePage(),_elk_switchToActiveX())}function _elk_onerrorfn(){_elk_new_proto?_elk_err_try=!0:_elk_enablePage()}function _elk_round8(e){var t="";for(i=0;i<8;i++)t=e%10+t,e=Math.floor(e/10);return t}function _elk_createDiv(){var e=document.createElement("div");e.id="_elk_disablingDiv",document.body.insertBefore(e,document.body.childNodes[0]);var t=document.createElement("STYLE"),i=document.createTextNode("#_elk_disablingDiv {display: none; z-index:10001; position: absolute; top: 0%; left: 0%; width: 100%; height: 100%; background-color: white; opacity:.00; filter: alpha(opacity=00);}");try{t.appendChild(i),document.head.insertBefore(t,document.head.childNodes[0])}catch(e){}}function _elk_disablePage(){document.getElementById("_elk_disablingDiv").style.display="block"}function _elk_enablePage(){document.getElementById("_elk_disablingDiv").style.display="none"}function _elk_detectBrowser(){-1!=navigator.userAgent.indexOf("Edge")?bEdge=!0:-1!=navigator.userAgent.indexOf("Firefox")?bFirefox=!0:-1!=navigator.userAgent.indexOf("Chrome")?bChrome=!0:bIE=!0}function _elk_byteLength(e){for(var t=e.length,i=e.length-1;i>=0;i--){var n=e.charCodeAt(i);n>127&&n<=2047?t++:n>2047&&n<=65535&&(t+=2),n>=56320&&n<=57343&&i--}return t}var _elk_DSObjCount=0,_elk_desksignObj=new _elk_DS,_elk_new_proto=!0,_elk_err_try=!1,_elk_send_queue=[],_elk_lastmsg="",bChrome=!1,bFirefox=!1,bEdge=!1,bIE=!1;