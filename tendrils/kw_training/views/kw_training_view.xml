<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record id="view_kw_training_proposal_search" model="ir.ui.view">
            <field name="name">view.kw_training_proposal.search</field>
            <field name="model">kw_training</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search>
                    <filter string="Current Financial Year" name="current_financial_year" domain="[('current_financial_year','=','current')]"/>
                    <separator/>
                    <field name="name"/>
                    <separator/>
                    <filter string="Instructor (Internal)" name="internal_instructor" icon="terp-personal" domain="[('instructor_type','=','internal')]"/>
                    <filter string="Instructor (External)" name="external_instructor" icon="terp-personal" domain="[('instructor_type','=','external')]"/>
                    <separator/>
                    <filter name="training_type" string="Others" domain="[('training_type', '=', 'Others')]"/>
                    <filter name="training_type" string="PIP Training" domain="[('training_type', '=', 'PIP')]"/>
                    <separator/>
                    <filter string="Not Planned" name="training_not_planned" domain="[('plan_status', '=', 'Not Planned')]"/>
                    <filter string="Applied" name="training_applied" domain="[('plan_ids.state', '=', 'apply')]"/>
                    <filter string="Approved" name="training_approved" domain="[('plan_ids.state', '=', 'approved')]"/>
                    <filter string="Rejected" name="training_rejected" domain="[('plan_status', '=', 'Rejected')]"/>
                    <separator/>
                    <filter string="Upcoming" name="upcoming_training" domain="[('start_date', '&gt;', time.strftime('%%Y-%%m-%%d'))]"/>
                    <filter string="Completed" name="completed_training" domain="[('end_date', '&lt;', time.strftime('%%Y-%%m-%%d')),('plan_ids.state', '=', 'approved')]"/>
                    <filter string="In Progress" name="in_progress_training" 
                            domain="[('start_date', '&lt;=', time.strftime('%%Y-%%m-%%d')),('end_date', '&gt;=', time.strftime('%%Y-%%m-%%d'))]"/>
                    <group expand="0" string="Group By">
                        <filter string="Instructor" name="instructor_type" context="{'group_by':'instructor_type'}"/>
                        <filter string="Training Date" name="group_training" context="{'group_by':'start_date'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="action_kw_training_proposal" model="ir.actions.act_window">
            <field name="type">ir.actions.act_window</field>
            <field name="name">Trainings</field>
            <field name="res_model">kw_training</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="view_type">form</field>
            <field name="context">{'search_default_current_financial_year':1}</field>
            <field name="search_view_id" ref="view_kw_training_proposal_search"/>
        </record>

        <record id="view_kw_training_tree" model="ir.ui.view">
            <field name="name">kw_training.tree</field>
            <field name="model">kw_training</field>
            <field name="arch" type="xml">
                <tree import="false">
                    <field name="name"/> 
                    <field name="instructor_type"/>
                    <field name="start_date"/>
                    <field name="end_date"/>
                    <field name="plan_status" string="Plan Status"/>
                </tree>
            </field>
        </record>

        <record id="view_kw_training_form" model="ir.ui.view">
            <field name="name">kw_training.form</field>
            <field name="model">kw_training</field>
            <field name="arch" type="xml">
                <form string="Proposal" delete='0' duplicate='0'>
                   
                    <field name="plan_status" invisible="1"/>
                    <field name="session_count" invisible="1"/>
                    <field name="material_count" invisible="1"/>
                    <field name="material_count" invisible="1"/>
                    <field name="feedback_count" invisible="1"/>
                    <field name="assessment_ids" invisible="1"/>
                    <field name="session_ids" invisible="1"/>
                    <sheet>
                        <div class="oe_button_box" name="button_box" style="width:100%;margin-top:-16px;margin-right:-16px;">
                        
                            <button attrs="{'invisible': [('plan_status','=','Not Planned')]}" class="oe_stat_button text-center" icon="fa-tasks"  type="object" name="view_training_plan">
                                <span class="o_stat_text font-weight-bold">
                                    Plan <field name="plan_status"/>
                                </span>
                            </button>

                            <button attrs="{'invisible': [('plan_status','!=','Not Planned')]}" class="oe_stat_button text-center" icon="fa-tasks" type="object" name="view_training_plan">
                                <span class="o_stat_text font-weight-bold">
                                    <field name="plan_status"/>
                                </span>
                            </button>

                            <button name="view_training_session" attrs="{'invisible': [('plan_status','!=','Approved')]}" class="oe_stat_button" icon="fa-calendar" type="object">
                                <div class="o_stat_info">
                                    <span class="o_stat_text font-weight-bold">
                                        <field name="session_count"/>
                                        Session(s)
                                    </span>
                                </div>
                            </button>

                            <button name="view_training_material"  class="oe_stat_button" attrs="{'invisible': [('plan_status','!=','Approved')]}" icon="fa-folder-open" type="object">
                                <div class="o_stat_info">
                                    <span class="o_stat_text font-weight-bold">
                                        <field name="material_count"/>
                                        Content(s)
                                    </span>
                                </div>
                            </button>

                            <button name="view_training_feedback" type="object" attrs="{'invisible': [('plan_status','!=','Approved')]}" class="oe_stat_button" icon="fa-comments">
                                <div class="o_stat_info">
                                    <span class="o_stat_text font-weight-bold">
                                        <field name="feedback_count"/>
                                        Feedback(s)
                                    </span>
                                </div>
                            </button>

                            <button name="view_training_assessment" type="object" attrs="{'invisible': ['|',('plan_status','!=','Approved'),('assessment_ids','=',False)]}" class="oe_stat_button" icon="fa-pencil">
                                <div class="o_stat_info">
                                    <span class="o_stat_text font-weight-bold">
                                        Assessment
                                    </span>
                                </div>
                            </button>
                            <button name="view_trainers_feedback" type="object" attrs="{'invisible': [('plan_status','!=','Approved')]}" class="oe_stat_button" icon="fa-comments">
                                <div class="o_stat_info">
                                    <span class="o_stat_text font-weight-bold">
                                        <!-- <field name="feedback_count"/> -->
                                        Trainers
                                        Feedback
                                    </span>
                                </div>
                            </button>

                            <button name="generate_certificate" type="object" class="oe_stat_button" attrs="{'invisible': [('plan_status', '!=', 'Approved')]}" icon="fa-certificate">
                                <div class="o_stat_info">
                                    <span class="o_stat_text font-weight-bold">
                                        Generate
                                        Certificate
                                    </span>
                                </div>
                            </button>

                        </div>
                        <group>
                            <group>
                                <field name="training_req_id" options="{'no_create': True, 'no_open': True,'no_edit':True}"/>
                                <field name="financial_year" options="{'no_create': True, 'no_open': True,'no_edit':True}"/>
                                <field name="training_type" readonly="1"/>
                                <field name="pip_ref"  attrs="{'invisible': [('training_type','!=','PIP')],'required':[('training_type','=','PIP')]}" readonly="1"/>
                                <field name="pip_training_id" options="{'no_open': True,'no_create':True,'no_edit':True}" invisible="1" readonly="1"/>
                                <field name="course_type_id" options="{'no_create': True, 'no_open': True,'no_edit':True}"/>
                                <field name="course_id" domain="[('skill_type.id', '=', course_type_id)]" options="{'no_create': True, 'no_open': True,'no_edit':True}"/>
                                <field name="name" autocomplete="off"/>
                                <field name="start_date"/>
                                <field name="end_date"/>
                                <field name="instructor_type"/>
                                <field name="highlight"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="kw_training_kanban_view" model="ir.ui.view">
            <field name="name">Proposal</field>
            <field name="model">kw_training</field>
            <field name="arch" type="xml">
                <kanban import="false" delete='false'>
                    <field name ="financial_year"/>
                    <field name="training_type"/>
                    <field name ="course_type_id"/>
                    <field name ="course_id" options="{'no_create': True, 'no_open': True,'no_edit':True}"/>
                    <field name="name"/>
                    <field name="start_date"/>
                    <field name="end_date"/>
                    <field name="instructor_type"/>
                    <field name="state"/>
                    <field name="is_participant"/>
                    <field name="color"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_card oe_kanban_global_click" 
                                t-attf-style="border-left: 5px solid {{ record.color.raw_value}}">
                                <div class="oe_kanban_body">
                                    <div class="font-weight-bold h2 text-center mb-3">
                                        <field name="name"/>
                                    </div>
                                    <span class="text-left font-weight-bold">
                                        From : <field name="start_date"/>
                                    </span>
                                    <span class="text-right font-weight-bold" style="float:right;">
                                        To : <field name="end_date"/>
                                    </span>
                                    <p class="text-left font-weight-bold">
                                        Instructor : <field name="instructor_type"/>
                                    </p>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="action_kw_training_proposal_act_window_view_tree" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_kw_training_tree"/>
            <field name="act_window_id" ref="action_kw_training_proposal"/>
        </record>

        <record id="action_kw_training_proposal_act_window_view_form" model="ir.actions.act_window.view">
            <field eval="3" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_kw_training_form"/>
            <field name="act_window_id" ref="action_kw_training_proposal"/>
        </record>

        <record id="action_kw_training_proposal_act_window_view_kanban" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">kanban</field>
            <field name="view_id" ref="kw_training_kanban_view"/>
            <field name="act_window_id" ref="action_kw_training_proposal"/>
        </record>

        <menuitem name="Trainings" parent="menu_kw_training_root" id="menu_kw_training_proposal" action="action_kw_training_proposal" sequence="2" groups="group_kw_training_manager"/>

    </data>
</odoo>