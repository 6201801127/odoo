<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <!-- Tree view for "model" -->
        <record id="viewkw_timesheet_report_tree" model="ir.ui.view">
            <field name="name">view.kw_timesheet_report.tree</field>
            <field name="model">kw_timesheet_report</field>
            <field name="type">tree</field>
            <field name="mode">primary</field>
            <field name="priority" eval="16" />
            <field name="active" eval="True" />
            <field name="arch" type="xml">
                <tree string="kw_timesheet_report_tree"  create="false" edit="false" delete="false" import="false" default_order="date desc">
                    <field name="employee_name" />
                    <field name="desg_name" /> 
                    <field name="dept_name" />
                    <field name="division" />
                    <field name="location"/>
                    <field name="project" />
                    <field name="category_name" />
                    <!-- <field name="opportunity" /> -->
                    <field name="project_task" />
                    <field name="date" />
                    <field name="desc" />
                    <field name="timesheet_effort" />
                    <field name="project_id" invisible = '1'/>
                    <!-- <field name="project_tagged" /> -->
                    <!-- <field name="tagging_employee" /> -->
                    <!-- <field name="active"/> -->
                    <field name="effort_hour" string="Duration (Hours)" sum="Total" readonly="1" widget="timesheet_uom"/>
                </tree>
            </field>
        </record>

        <!-- Search view for "model" -->
        <record id="view_kw_timesheet_report_search" model="ir.ui.view">
            <field name="name">view.kw_timesheet_report.search</field>
            <field name="model">kw_timesheet_report</field>
            <field name="type">search</field>
            <field name="mode">primary</field>
            <field name="priority" eval="16" />
            <field name="active" eval="True" />
            <field name="arch" type="xml">
                <search string="kw_timesheet_report_search">
                    <field name="employee_name" />
                    <field name="desg_name" /> 
                    <field name="dept_name" />
                    <field name="division" />
                    <field name="location"/>
                    <field name="project" />
                    <field name="category_name" />
                    <field name="project_task" />
                    <!-- <field name="project_tagged" /> -->

                    <filter string="Date" name="filter_date" date="date"/>
                    <filter string="This Month" name="filter_current_month" domain="[('date', 'like',context_today().strftime('%Y-%m-%'))]" />
                    <filter string="Last Month" name="filter_last_month" domain="[('date', '&gt;',(context_today()-relativedelta(months=1)).strftime('%Y-%m-01')),('date','&lt;',(context_today()).strftime('%Y-%m-01'))]" />
                    <separator/>

                    <filter name="my_reports" string="My Reports" domain="[('employee_id.user_id','=',uid)]"/>
                    <!-- <filter name="filter_tagged_employee" string="Tagged Timesheet"  domain="[('project_tagged','=', 'taggged')]" />
                    <filter name="filter_tagged_employee_timesheet" string="Non Tagged Timesheet"  domain="[('project_tagged','=', 'non-tagged')]" /> -->
                    <!-- <filter name="filter_non_tagged_employee" string="Tagged  Employee"  domain="[('tagging_employee','=','non-tagged')]" /> -->
                    <filter name="my_and_sub_ordinate_timesheet" string="My &amp; Sub-Ordinates" domain="['|',('employee_id.user_id','=',uid),('employee_id.parent_id.user_id','=',uid)]" />
                    <group>
                        <filter name="group_by_parent_id" string="Reporting Authority" context="{'group_by':'parent_id'}" /> 
                        <filter name="group_by_employee" string="Employee" context="{'group_by':'employee_id'}" /> 
                        <filter name="group_by_project" string="Project" context="{'group_by':'project_id'}" /> 
                    </group>
                </search>
            </field>
        </record>

        <record id="view_timesheet_report_pivot" model="ir.ui.view">
            <field name="name">timesheet_pivot</field>
            <field name="model">kw_timesheet_report</field>
            <field name="arch" type="xml">
                <pivot string="Timesheet Repoet">
                   <field name="employee_name" type="row"/>
                   <field name="effort_hour" string='Duration(Hour(s))' type="measure"/>
                   <!-- <field name="category_name" />
                   <field name="project_task" />
                   <field name="date" /> -->
                </pivot>
            </field>
        </record>

        <!-- Main window action for "model" -->
        <record id="action_kw_timesheet_report_window" model="ir.actions.act_window">
            <field name="type">ir.actions.act_window</field>
            <field name="name">Timesheet Report</field>
            <field name="res_model">kw_timesheet_report</field>
            <field name="view_mode">tree</field>
            <field name="view_type">form</field>
            <field name="target">current</field>
            <field name="domain">[]</field>
            <field name="context">{'search_default_filter_current_month':1,'timesheet_report':1,'group_by': 'employee_id'}</field>
            <field name="search_view_id" ref="view_kw_timesheet_report_search"/>
        </record>

        <menuitem name="Timesheet Report" action="action_kw_timesheet_report_window" id="menu_analytic_timesheet__report" parent="hr_timesheet.menu_timesheets_reports" groups="hr_timesheet.group_timesheet_manager,kw_timesheets.group_kw_timesheets_report_manager,hr_timesheet.group_hr_timesheet_user"/>
    </data>
</odoo>
