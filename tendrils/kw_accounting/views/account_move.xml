<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data noupdate="0">
        <record id="account.view_move_form" model="ir.ui.view">
            <field name="name">account.move.form</field>
            <field name="model">account.move</field>
            <field name="arch" type="xml">
                <form string="Account Entry" duplicate="false">
                    <header>
                        <button name="action_post" states="draft" string="Validate" type="object"
                            class="oe_highlight" groups="account.group_account_manager"
                            confirm="Are you sure, you want to validate?" />
                        <button name="%(account.action_view_account_move_reversal)d" states="posted"
                            string="Reverse Entry" type="action"
                            groups="account.group_account_invoice" />
                        <button name="action_duplicate" string="Duplicate" type="object"
                            groups="account.group_account_invoice" />
                        <button name="preview_moves" type="object" string="Preview" />
                        <field name="state" widget="statusbar" />
                    </header>
                    <sheet>
                        <field name="tax_type_domain" invisible="1" />
                        <field name="id" invisible="1" />
                        <div class="oe_button_box">
                            <button name="action_view_reverse_entry"
                                type="object"
                                class="oe_stat_button"
                                icon="fa-refresh"
                                attrs="{'invisible': [('reverse_entry_id', '=', False)]}"
                                string="Reversed entry">
                            </button>
                            <button name="open_reconcile_view"
                                class="oe_stat_button"
                                icon="fa-bars"
                                type="object"
                                string="Reconciled entries">
                            </button>
                        </div>
                        <h1>
                            <field name="name" readonly="True"
                                attrs="{'invisible':[('name','=','/')]}" />
                        </h1>
                        <group>
                            <group>
                                <field name="date" options="{'datepicker':{'maxDate': 'now'}}" />
                                <field name="ref" required="0" invisible="0" />
                                <field name="payment_method_type" />
                                <field name="cheque_date"
                                    attrs="{'invisible':[('payment_method_type','!=','Cheque')]}" />
                                <field name="cheque_reference"
                                    attrs="{'invisible':[('payment_method_type','!=','Cheque')]}" />
                            </group>
                            <group>
                                <field name="journal_id"
                                    options="{'no_open': True, 'no_create': True}" />
                                <field name="company_id" required="1"
                                    groups="base.group_multi_company" />
                                <field name="amount" invisible="1" />
                                <field name="currency_id" invisible="0" />
                                <field name="tds_applicable" />
                            </group>
                        </group>
                        <notebook>
                            <page string="Journal Items">
                                <field name="line_ids" widget="one2many_list"
                                    context="{'line_ids': line_ids, 'journal_id': journal_id }">
                                    <tree editable="bottom" string="Journal Items"
                                        class="customer_tree">
                                        <field name="tax_line_id" invisible="1" />
                                        <field name="budget_type" required="1"/>
                                        <field name="project_id"
                                            attrs="{'invisible': [('budget_type','in',('treasury','other'))], 'required':[('budget_type','in',('project'))]}"
                                            invisible="1" />
                                        <field name="branch_id" invisible="1" />

                                        <field name="partner_id" options='{"no_open": True, "no_create": True}'
                                            domain="['|', ('parent_id', '=', False), ('is_company', '=', True),'|',('customer','=',True),('supplier', '=', True),('vendor_state', '=', 'approved')]" />
                                        
                                        <field name="employee_id"
                                            options="{'no_open': True, 'no_create':True, 'no_create_edit':True}"
                                            domain="['|', ('active', '=', False), ('active', '=', True)]" />
                                        <field name="name" />
                                        <field name="analytic_account_id"
                                            groups="analytic.group_analytic_accounting" />
                                        <field name="analytic_tag_ids"
                                            groups="analytic.group_analytic_tags"
                                            widget="many2many_tags" />
                                        <field name="amount_currency"
                                            groups="base.group_multi_currency" />
                                        <field name="company_currency_id" invisible="1" />
                                        <field name="company_id" invisible="1" />
                                        <field name="branch_id" invisible="1" />
                                        <field name="currency_id" options="{'no_create': True}"
                                            groups="base.group_multi_currency" />
                                        <field name="account_id"
                                            domain="[('branch_id', '=', branch_id), ('deprecated', '=', False)]"
                                            options='{"no_open": False, "no_create": True}' />
                                        <field name="debit" sum="Total Debit" />
                                        <field name="credit" sum="Total Credit" />
                                        <!-- <field name="tax_ids" string="Taxes Applied"
                                        widget="many2many_tags"
                                           domain="[('type_tax_use', '=?', parent.tax_type_domain)]"
                                           context="{'append_type_to_tax_name': not parent.tax_type_domain}"
                                           options="{'no_create': True}"/> -->
                                        <field name="date_maturity" required="0"
                                            invisible="context.get('view_no_maturity', False)" />
                                        <field name="recompute_tax_line" invisible="1" readonly="1" />
                                        <field name="tax_line_grouping_key" invisible="1"
                                            readonly="1" />
                                    </tree>
                                    <!-- Form view to cover mobile use -->
                                    <form>
                                        <group>
                                            <field name="tax_line_id" invisible="1" />
                                            <field name="account_id"
                                                domain="[('company_id', '=', parent.company_id), ('deprecated', '=', False)]" />
                                            <field name="partner_id"
                                                domain="['|', ('parent_id', '=', False), ('is_company', '=', True)]" />
                                            <field name="name" />
                                            <field name="analytic_account_id"
                                                groups="analytic.group_analytic_accounting" />
                                            <field name="analytic_tag_ids"
                                                groups="analytic.group_analytic_tags"
                                                widget="many2many_tags" />
                                            <field name="amount_currency"
                                                groups="base.group_multi_currency" />
                                            <field name="company_currency_id" invisible="1" />
                                            <field name="company_id" invisible="1" />
                                            <field name="currency_id" options="{'no_create': True}"
                                                groups="base.group_multi_currency" />
                                            <field name="debit" sum="Total Debit" />
                                            <field name="credit" sum="Total Credit" />
                                            <!-- <field name="tax_ids" string="Taxes Applied"
                                            widget="many2many_tags" domain="[('type_tax_use', '=?',
                                            parent.tax_type_domain)]"
                                            context="{'append_type_to_tax_name': not
                                            parent.tax_type_domain}" options="{'no_create': True}"/> -->
                                            <field name="date_maturity" required="0"
                                                invisible="context.get('view_no_maturity', False)" />
                                            <field name="recompute_tax_line" invisible="1"
                                                readonly="1" />
                                            <field name="tax_line_grouping_key" invisible="1"
                                                readonly="1" />
                                        </group>
                                    </form>
                                </field>

                                <group
                                    attrs="{'invisible':[('tds_applicable','not in',('payable','receivable'))]}">
                                    <field name="tds_line_ids" string="TDS Lines">
                                        <tree string="TDS Lines" editable="bottom"
                                            class="customer_tree">
                                            <field name="sequence" widget="handle" />
                                            <field name="company_id" invisible="1" />
                                            <field name="partner_id" invisible="0"
                                                domain="['|','&amp;',('customer','=',True),('property_account_receivable_id','!=',False),'&amp;',('supplier','=',True),('property_account_payable_id','!=',False)]" />
                                            <field name="invoice_id" invisible="1" />
                                            <field name="invoice_type" invisible="1" />
                                            <field name="currency_id" invisible="1" />
                                            <field name="company_currency_id" invisible="1" />
                                            <field name="account_id"
                                                options='{"no_open": False, "no_create": True}' />
                                            <field name="base_amount" />
                                            <field name="percentage" />
                                            <field name="ds_amount" />
                                        </tree>
                                    </field>
                                </group>
                                <group>
                                    <field name="narration" colspan="4"
                                        placeholder="Add an internal note..." string="Narration"
                                        height="50" required="True" />
                                </group>
                            </page>
                            <page string="Other Info">
                                <group>
                                    <field name="auto_reverse"
                                        attrs="{'readonly':[('reverse_entry_id', '!=', False)]}" />
                                    <field name="reverse_date"
                                        attrs="{'invisible':[('auto_reverse', '=', False)], 'required':[('auto_reverse', '=', True)],'readonly':[('reverse_entry_id', '!=', False)]}" />
                                    <field name="reverse_entry_id" attrs="{'invisible':True}" />
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" groups="base.group_user" />
                        <field name="activity_ids" widget="mail_activity" />
                        <field name="message_ids" widget="mail_thread" />
                    </div>
                </form>
            </field>
        </record>

        <record id="kw_accounting.preview_move_form1" model="ir.ui.view">
            <field name="name">account.move.form</field>
            <field name="model">account.move</field>
            <field name="arch" type="xml">
                <form string="Preview Vouchers" banner_route="/accounting/preview_move">
                    <footer class="text-center">
                        <field name="state" invisible="1" />
                        <button name="action_post" states="draft" string="Validate" type="object"
                            class="oe_highlight" groups="account.group_account_manager"
                            confirm="Are you sure, you want to validate?" />
                        <button name="print_voucher" string="Print" type="object" default_focus="1"
                            class="oe_highlight" />
                        <button string="Cancel" class="btn btn-default" special="cancel" />
                    </footer>
                </form>
            </field>
        </record>

        <template id="kw_accounting.preview_move_vouchers">
            <div class="container">
                <div class="alert alert-info text-center" role="alert">
                    <a class="alert-link h2">
                        <t t-esc="vals['move_type']" />
                    </a>
                </div>
                <div class="text-center">

                    <h2><t t-esc="vals['company']" /> / <t t-esc="vals['branch']" /></h2>
                </div>
                <div class="d-flex justify-content-between mb-5">
                    <t t-if="vals['type'] == 'payment'">
                        <div>
                            <p class="h3"
                                style="color: #fff;text-align: center;background: teal;border-radius: 3px;">
                                Payment To</p>
                            <p class="mb-1"><b>
                                    <t t-esc="vals['name_type']" />
                                </b>
                                : <t t-esc="vals['customer']" /></p>
                            <p class="mb-1"><b>GST Treatment </b>: <t t-esc="vals['gst_treatment']" /></p>
                            <p class="mb-1"><b>GSTIN </b>: <t t-esc="vals['gstin']" />
                            </p>
                            <p class="mb-1"><b>PAN </b>: <t t-esc="vals['pan']" /></p>
                            <p class="mb-1"><b>State </b>: <t t-esc="vals['state']" />
                            </p>
                        </div>
                        <div>
                            <p class="h3"
                                style="color: #fff;text-align: center;background: teal;border-radius: 3px;">
                                Payment From </p>
                            <p class="mb-1">
                                <b>Bank : </b>
                                <t t-esc="vals['payment_from']" />
                            </p>
                            <p class="mb-1">
                                <b>Mode Of Payment : </b>
                                <t t-esc="vals['mode_of_payment']" />
                            </p>
                            <p class="mb-1">
                                <b>Cheque No.\Draft No.\RTGS No.\NEFT No. : </b>
                                <t t-esc="vals['cheque_no']" />
                            </p>
                            <p class="mb-1">
                                <b>Cheque Date : </b>
                                <t t-esc="vals['cheque_date']" />
                            </p>
                        </div>
                    </t>
                    <t t-if="vals['type'] == 'receipt'">
                        <div>
                            <p class="h3"
                                style="color: #fff;text-align: center;background: teal;border-radius: 3px;">
                                Receipt To </p>
                            <p class="mb-1">
                                <b>Bank : </b>
                                <t t-esc="vals['payment_from']" />
                            </p>
                            <p class="mb-1">
                                <b>Mode Of Payment : </b>
                                <t t-esc="vals['mode_of_payment']" />
                            </p>
                            <p class="mb-1">
                                <b>Cheque No.\Draft No.\RTGS No.\NEFT No. : </b>
                                <t t-esc="vals['cheque_no']" />
                            </p>
                            <p class="mb-1">
                                <b>Cheque Date : </b>
                                <t t-esc="vals['cheque_date']" />
                            </p>
                        </div>
                        <div>
                            <p class="h3"
                                style="color: #fff;text-align: center;background: teal;border-radius: 3px;">
                                Receipt From</p>
                            <p class="mb-1"><b>
                                    <t t-esc="vals['name_type']" />
                                </b>
                                : <t t-esc="vals['customer']" /></p>
                            <p class="mb-1"><b>GST Treatment </b>: <t t-esc="vals['gst_treatment']" /></p>
                            <p class="mb-1"><b>GSTIN </b>: <t t-esc="vals['gstin']" />
                            </p>
                            <p class="mb-1"><b>PAN </b>: <t t-esc="vals['pan']" /></p>
                            <p class="mb-1"><b>State </b>: <t t-esc="vals['state']" />
                            </p>
                        </div>
                    </t>
                </div>

                <table class="table table-bordered table-sm table-striped">
                    <thead>
                        <tr>
                            <td colspan="9" style="background: #fff; padding: 1rem;">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4>Voucher No: <t t-esc="vals['voucher_no']" /></h4>
                                    </div>
                                    <div>
                                        <h4>Date: <t t-esc="vals['date']" /></h4>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th
                                style="color: #fff;text-align: center;background: teal;border-radius: 3px; width: 50%;">Ledger
                                (Activity) Head</th>
                            <th
                                style="color: #fff;text-align: right;background: teal;border-radius: 3px;">
                                Amount</th>
                            <th
                                style="color: #fff;text-align: left;background: teal;border-radius: 3px;">
                                Budget Type</th>
                            <th
                                style="color: #fff;text-align: center;background: teal;border-radius: 3px;">
                                Project</th>
                            <th
                                style="color: #fff;text-align: center;background: teal;border-radius: 3px;">
                                Department</th>
                            <th
                                style="color: #fff;text-align: center;background: teal;border-radius: 3px;">
                                Division</th>
                            <th
                                style="color: #fff;text-align: center;background: teal;border-radius: 3px;">
                                Section</th>
                            <th
                                style="color: #fff;text-align: center;background: teal;border-radius: 3px;">
                                Employee</th>
                            <th
                                style="color: #fff;text-align: center;background: teal;border-radius: 3px;">Capital
                                Budget</th>
                            <th
                                style="color: #fff;text-align: center;background: teal;border-radius: 3px;">Budget
                                Line</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="10" style="background: #fff;">
                                Debit
                            </td>
                        </tr>
                        <tr>
                            <t t-set="debit_amount" t-value="0" />
                            <t t-foreach="vals['ledger_data']" t-as="ledger">
                                <t t-if="ledger['debit_amount'] > 0">
                                    <tr>
                                        <td>
                                            <t t-esc="ledger['account_id']" /> - <span
                                                class="text-danger font-weight-bold"
                                                t-esc="ledger['account']" /> - <t
                                                t-esc="ledger['account_code']" />
                                        </td>
                                        
                                        <td class="text-right">
                                            <t t-esc="ledger['debit_amount']"
                                                t-options="{'widget': 'monetary', 'display_currency': vals['currency']}" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['budget_type']" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['project']" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['department']" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['division']" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['section']" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['employee']" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['capital_budget']" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['budget_line']" />
                                        </td>
                                        <t t-set="debit_amount"
                                            t-value="debit_amount + ledger['debit_amount']" />
                                    </tr>
                                </t>
                            </t>
                        </tr>
                        <tr>
                            <td class="text-right">Total</td>
                            <td class="text-right">
                                <t t-esc="debit_amount"
                                    t-options="{'widget': 'monetary', 'display_currency': vals['currency']}" />
                            </td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td colspan="10" style="background: #fff;">
                                Credit
                            </td>
                        </tr>
                        <tr>
                            <t t-set="credit_amount" t-value="0" />
                            <t t-foreach="vals['ledger_data']" t-as="ledger">
                                <t t-if="ledger['credit_amount'] > 0">
                                    <tr>
                                        <td>
                                            <t t-esc="ledger['account_id']" /> - <span
                                                class="text-danger font-weight-bold"
                                                t-esc="ledger['account']" /> - <t
                                                t-esc="ledger['account_code']" />
                                        </td>
                                        <td class="text-right">
                                            <t t-esc="ledger['credit_amount']"
                                            t-options="{'widget': 'monetary', 'display_currency': vals['currency']}" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['budget_type']" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['project']" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['department']" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['division']" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['section']" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['employee']" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['capital_budget']" />
                                        </td>
                                        <td>
                                            <t t-esc="ledger['budget_line']" />
                                        </td>
                                        <t t-set="credit_amount"
                                            t-value="credit_amount + ledger['credit_amount']" />
                                    </tr>
                                </t>
                            </t>
                        </tr>
                        <tr>
                            <td class="text-right">Total</td>
                            <td class="text-right">
                                <t t-esc="credit_amount"
                                    t-options="{'widget': 'monetary', 'display_currency': vals['currency']}" />
                            </td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>

                        <tr>
                            <td colspan="10"
                                style="font-weight: bold; background: #fff; color: teal;">
                                TDS Line
                            </td>
                        </tr>
                        <tr>
                            <th style="background: teal; color: white; width: 20% !important;">
                                Partner</th>
                            <th style="background: teal; color: white; width: 20% !important;">Nature
                                of Payment</th>
                            <th style="background: teal; color: white; width: 20% !important;">Under
                                Section</th>
                            <th style="background: teal; color: white; width: 20% !important;"
                                colspan="2">Base Amount</th>
                            <th style="background: teal; color: white; width: 20% !important;">
                                Percentage</th>
                            <th style="background: teal; color: white; width: 20% !important;"
                                colspan="4">TDS Amount</th>
                        </tr>
                        <t t-set="base_amount" t-value="0.0" />
                        <t t-set="ds_amount" t-value="0.0" />
                        <t t-foreach="vals['tds_list']" t-as="line">
                            <tr>
                                <td>
                                    <t t-esc="line['partner']" />
                                </td>
                                <td>
                                    <t t-esc="line['nature']" />
                                </td>
                                <td>
                                    <t t-esc="line['under_section']" />
                                </td>
                                <td class="text-right" colspan="2">
                                    <t t-esc="line['base_amount']"
                                        t-options="{'widget': 'monetary', 'display_currency': vals['currency']}" />
                                </td>
                                <td class="text-right">
                                    <t t-esc="line['percentage']" />
                                </td>
                                <td class="text-right" colspan="4">
                                    <t t-esc="line['ds_amount']"
                                        t-options="{'widget': 'monetary', 'display_currency': vals['currency']}" />
                                </td>
                                <t t-set="base_amount" t-value="base_amount + line['base_amount']" />
                                <t t-set="ds_amount" t-value="ds_amount + line['ds_amount']" />
                            </tr>
                        </t>
                        <tr>
                            <td></td>
                            <td></td>
                            <td class="text-right">Total</td>
                            <td class="text-right" colspan="2">
                                <t t-esc="base_amount"
                                    t-options="{'widget': 'monetary', 'display_currency': vals['currency']}" />
                            </td>
                            <td></td>
                            <td class="text-right" colspan="4">
                                <t t-esc="ds_amount"
                                    t-options="{'widget': 'monetary', 'display_currency': vals['currency']}" />
                            </td>
                        </tr>
                        <tr>
                            <td colspan="10"
                                style="font-weight: bold; background: #fff; color: teal;">
                                &amp;emsp;
                            </td>
                        </tr>
                        <tr>
                            <td colspan="1" class="font-weight-bold">Narration:</td>
                            <td colspan="9">
                                <t t-esc="vals['narration']" />
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </template>

        <record id="kw_accounting.voucher_report_format" model="report.paperformat">
            <field name="name">Voucher Report Format</field>
            <field name="default" eval="True" />
            <field name="format">custom</field>
            <field name="page_height">297</field>
            <field name="page_width">210</field>
            <field name="orientation">Portrait</field>
            <field name="margin_top">10</field>
            <field name="margin_bottom">10</field>
            <field name="margin_left">5</field>
            <field name="margin_right">5</field>
            <field name="header_line" eval="False" />
            <field name="header_spacing">10</field>
            <field name="dpi">90</field>
        </record>

        <report
            id="account_print_vouchers"
            model="account.move"
            string="Print Voucher"
            report_type="qweb-pdf"
            name="kw_accounting.print_voucher"
            file="kw_accounting.print_voucher"
            attachment="(object.state in ('posted')) and ('INV'+(object.name or '').replace('/','')+'.pdf')"
            paperformat="kw_accounting.voucher_report_format"
            print_report_name="(object._get_report_base_filename())"
        />

        <report
            id="brs_print_vouchers"
            model="account.move.line"
            string="Print BRS Report"
            report_type="qweb-pdf"
            name="kw_accounting.brs_print"
            file="kw_accounting.brs_print"
            attachment="((object.name or '')+'.pdf')"
            paperformat="kw_accounting.voucher_report_format"
            print_report_name="BRS-Report.pdf"
        />

        <record model="ir.ui.view" id="untagged_budget_line_tree_view">
            <field name="model">account.move.line</field>
            <field name="arch" type="xml">
                <tree string="Untagged Budget Lines" delete="false" create="false" edit="false">
                    <field name="budget_type" string="Budget Type"/>
                    <field name="move_id" string="Voucher No."/>
                    <field name="date" string="Voucher Date"/>
                    <field name="account_id" invisible="1" />
                    <field name="ledger_name" string="Ledger Name" />
                    <field name="ledger_code" string="Ledger Code" />
                    <field name="debit" />
                    <field name="credit" />
                    <button name="open_voucher" type="object" string="Edit"
                        class="oe_highlight btn btn-danger btn-sm" />
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="untagged_budget_line_search_view">
            <field name="model">account.move.line</field>
            <field name="arch" type="xml">
                <search string="Untagged Budget Lines">
                    <field name="move_id" />
                    <field name="budget_type" />
                    <field name="account_id" />
                    <group expand="0" string="Group By">
                        <filter string="Partner" name="partner" domain="[]"
                            context="{'group_by':'partner_id'}" />
                        <filter string="Journal" name="journal" domain="[]"
                            context="{'group_by':'journal_id'}" />
                        <filter string="Account" name="account" context="{'group_by':'account_id'}" />
                        <filter string="Date" name="groupby_date" domain="[]"
                            context="{'group_by':'date'}" />
                    </group>
                </search>
            </field>
        </record>

        <record id="untagged_budget_line_action_view" model="ir.actions.act_window">
            <field name="type">ir.actions.act_window</field>
            <field name="name">Untagged Budget Line Vouchers</field>
            <field name="res_model">account.move.line</field>
            <field name="view_mode">tree</field>
            <field name="view_type">form</field>
            <field name="target">current</field>
            <field name="view_ids"
                eval="[(5, 0, 0), 
                    (0, 0, {'view_mode': 'tree', 'view_id': ref('untagged_budget_line_tree_view')})]" />
            <field name="domain">
                [('budget_type','in',('treasury','project','capital')),('budget_line','=',False),('move_id.state','=','posted')]</field>
            <field name="search_view_id" ref="untagged_budget_line_search_view" />
            <field name="context">{"create": False,"edit": True,"import":True}</field>
        </record>


    </data>
</odoo>