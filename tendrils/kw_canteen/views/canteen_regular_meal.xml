<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data noupdate="0">
        <record id="view_kw_canteen_regular_meal_tree" model="ir.ui.view">
            <field name="name">view.kw_canteen_regular_meal.tree</field>
            <field name="model">kw_canteen_regular_meal</field>
            <field name="type">tree</field>
            <field name="mode">primary</field>
            <field name="priority" eval="16" />
            <field name="active" eval="True" />
            <field name="arch" type="xml">
                <tree string="kw_canteen_regular_meal_tree" create="true" delete="true" edit="true">
                    <field name="employee_id" />
                    <field name="department_id"/>
                    <field name="infra_unit_location_id"/>
                    <field name="desig_id"/>
                    <!-- <field name="food_type"/> -->
                    <field name="start_date" />
                    <field name="end_date" />
                    <field name="remarks" />
                    <field name="state" />

                </tree>
            </field>
        </record>

        <!-- Form view for "model" -->
        <record id="view_kw_canteen_regular_meal_form" model="ir.ui.view">
            <field name="name">view.kw_canteen_regular_meal.form</field>
            <field name="model">kw_canteen_regular_meal</field>
            <field name="type">form</field>
            <field name="mode">primary</field>
            <field name="priority" eval="16" />
            <field name="active" eval="True" />
            <field name="arch" type="xml">
                <form string="kw_canteen_regular_meal_form" create="true" delete="false" edit='true'>
                    <script>
                        $(document).ready(function(){ state=  $("[aria-pressed=true]").text().trim();
                        console.log(state);
                        if (state == 'Expired'){
                        $('.o_form_button_edit').hide();
                        }       
                        });
                    </script>
                    <header>
                        <button name="action_apply_regular_meal" type="object" string="Apply" groups="kw_canteen.canteen_emp_user_group" attrs="{'invisible':[('state', '!=', 'draft')]}" class="btn-primary"/>
                        <!-- <button name="action_approve_regular_meal" type="object" string="Approve" groups="kw_canteen.canteen_manager_group" attrs="{'invisible':[('state', 'in',['draft','approved','expired'])]}" class="btn-primary"/> -->
                        <button name="open_wizard" string="Apply Exclusion" class="btn-primary" type="object" attrs="{'invisible':[('state', 'in', ['draft','expired'])]}"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,approved" />
                    </header>
                    <sheet>
                        <!-- <div class="oe-tittle">
                            <h1 style="color:#108fbb">
                                Regular Meal Details
                            </h1>
                        </div> -->
                        <group>
                            <group string="Regular Meal Details">
                                <field name="employee_id" options="{'no_create':True,'no_create_edit':True,'no_open':True,'no_edit':True}"/>
                                <field name="infra_unit_location_id" required="0" options="{'no_create':True,'no_create_edit':True,'no_open':True,'no_edit':True}"/>
                                <!-- <field name="food_type" decoration-danger="state == 'expired'" attrs="{'readonly': [('state', '!=', 'draft')]}"/> -->
                                <field name="start_date" attrs="{'readonly': [('state', '!=', 'draft')]}" date='start_date'/>
                                <field name="end_date" attrs="{'readonly': [('state', '!=', 'draft')]}" date='end_date'/>
                                <field name="remarks" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                                <field name="is_special" groups="base.group_no_one" readonly="1"/>
                            </group>
                            <group string="Meal Choice">
                            <label for="opt_monday" string="Monday"  />
                            <div>
                                <field name="opt_monday" class="oe_inline" />
                                <span class="fa fa-cutlery mx-1"/>
                                <field name="monday_meal_id" class="oe_inline" options="{'no_create':True,'no_create_edit':True,'no_open':True,'no_edit':True}" 
                                    attrs="{'invisible':[('opt_monday','=',False)],'required':[('opt_monday','=',True)]}"/>

                            </div>
                            <label for="opt_tuesday" string="Tuesday"  />
                            <div >
                                <field name="opt_tuesday" class="oe_inline" />
                                <span class="fa fa-cutlery mx-1"/>
                                <field name="tuesday_meal_id" class="oe_inline" options="{'no_create':True,'no_create_edit':True,'no_open':True,'no_edit':True}" 
                                    attrs="{'invisible':[('opt_tuesday','=',False)],'required':[('opt_tuesday','=',True)]}"/>

                            </div>
                            <label for="opt_wedday" string="Wednesday"  />
                            <div >
                                <field name="opt_wedday" class="oe_inline" />
                                <span class="fa fa-cutlery mx-1"/>
                                <field name="wedday_meal_id" class="oe_inline" options="{'no_create':True,'no_create_edit':True,'no_open':True,'no_edit':True}" 
                                    attrs="{'invisible':[('opt_wedday','=',False)],'required':[('opt_wedday','=',True)],'readonly':[('state','=','expired')]}"/>

                            </div>
                            <label for="opt_thursday" string="Thursday"  />
                            <div >
                                <field name="opt_thursday" class="oe_inline" />
                                <span class="fa fa-cutlery mx-1"/>
                                <field name="thursday_meal_id" class="oe_inline" options="{'no_create':True,'no_create_edit':True,'no_open':True,'no_edit':True}" 
                                    attrs="{'invisible':[('opt_thursday','=',False)],'required':[('opt_thursday','=',True)]}"/>

                            </div>
                            <label for="opt_friday" string="Friday"  />
                            <div >
                                <field name="opt_friday" class="oe_inline" />
                                <span class="fa fa-cutlery mx-1"/>
                                <field name="friday_meal_id" class="oe_inline" options="{'no_create':True,'no_create_edit':True,'no_open':True,'no_edit':True}" 
                                    attrs="{'invisible':[('opt_friday','=',False)],'required':[('opt_friday','=',True)],'readonly':[('state','=','expired')]}"/>

                                </div>
                                <label for="opt_saturday" string="Saturday" />
                                <div>
                                    <field name="opt_saturday" class="oe_inline" />
                                    <span class="fa fa-cutlery mx-1" />
                                    <field name="saturday_meal_id" class="oe_inline" options="{'no_create':True,'no_create_edit':True,'no_open':True,'no_edit':True}" attrs="{'invisible':[('opt_saturday','=',False)],'required':[('opt_saturday','=',True)]}" />

                                </div>
                                <label for="opt_sunday" string="Sunday" />
                                <div>
                                    <field name="opt_sunday" class="oe_inline" />
                                    <span class="fa fa-cutlery mx-1" />
                                    <field name="sunday_meal_id" class="oe_inline" options="{'no_create':True,'no_create_edit':True,'no_open':True,'no_edit':True}" attrs="{'invisible':[('opt_sunday','=',False)],'required':[('opt_sunday','=',True)],'readonly':[('state','=','expired')]}" />

                                </div>

                                <!-- <group string="Opt For">
                                    <field name="opt_monday"/>
                                    <field name="opt_tuesday"/>
                                    <field name="opt_wedday"/>
                                    <field name="opt_thursday"/>
                                    <field name="opt_friday"/>
                                </group> -->
                                <!-- <group string="Menu" attrs="{'invisible':['&amp;','&amp;','&amp;','&amp;',('opt_monday','=',False),('opt_tuesday','=',False),('opt_wedday','=',False),('opt_thursday','=',False),('opt_friday','=',False)]}">
                                    <field name="monday_meal_id" options="{'no_create':True,'no_create_edit':True,'no_open':True,'no_edit':True}" attrs="{'invisible':[('opt_monday','=',False)],'required':[('opt_monday','=',True)]}"/>
                                    <field name="tuesday_meal_id" options="{'no_create':True,'no_create_edit':True,'no_open':True,'no_edit':True}" attrs="{'invisible':[('opt_tuesday','=',False)],'required':[('opt_tuesday','=',True)]}"/>
                                    <field name="wedday_meal_id" options="{'no_create':True,'no_create_edit':True,'no_open':True,'no_edit':True}" attrs="{'invisible':[('opt_wedday','=',False)],'required':[('opt_wedday','=',True)]}"/>
                                    <field name="thursday_meal_id" options="{'no_create':True,'no_create_edit':True,'no_open':True,'no_edit':True}" attrs="{'invisible':[('opt_thursday','=',False)],'required':[('opt_thursday','=',True)]}"/>
                                    <field name="friday_meal_id" options="{'no_create':True,'no_create_edit':True,'no_open':True,'no_edit':True}" attrs="{'invisible':[('opt_friday','=',False)],'required':[('opt_friday','=',True)]}"/>
                                </group> -->
                            </group>
                        </group>
                        <group attrs="{'invisible':[('apply_exclusion_boolean', '=',False)]}">
                            <field name="apply_exclusion_boolean" invisible='1' />
                            <field name="close_meal_ids" string="Exclusion Details">
                                <tree editable="top" create='0' delete='false'>
                                    <field name="exclusion_type" readonly="1" />
                                    <field name="start_date" string='Start Date' readonly="1" />
                                    <field name="end_date" readonly="1"  />
                                    <field name="reason" readonly="1" />
                                </tree>
                                <form>
                                    <group>
                                        <field name="exclusion_type" readonly="1" />
                                        <field name="start_date" string='Start Date' readonly="1" />
                                        <field name="end_date" readonly="1" />
                                        <field name="reason" readonly="1" />
                                    </group>
                                </form>
                            </field>
                        </group>
                    </sheet>
                    <group >
                        <div class="oe_chatter" >
                            <field name="message_follower_ids" widget="mail_followers" />
                            <field name="activity_ids" widget="mail_activity" />
                            <field name="message_ids" widget="mail_thread" />
                        </div>
                    </group>
                </form>
            </field>
        </record>

        <!-- Search view for "model" -->
        <record id="view_kw_canteen_regular_meal_search" model="ir.ui.view">
            <field name="name">view.kw_canteen_regular_meal.search</field>
            <field name="model">kw_canteen_regular_meal</field>
            <field name="type">search</field>
            <field name="mode">primary</field>
            <field name="priority" eval="16" />
            <field name="active" eval="True" />
            <field name="arch" type="xml">
                <search string="kw_canteen_regular_meal_search">
                    <field name="employee_id" />
                    <field name="remarks" />
                    <group expand="1" string="Group By">
                        <filter string="This Month" domain="[('start_date', 'like',context_today().strftime('%Y-%m'))]" name="this_month_regular_meal"/>
                        <separator/>
                        <filter string=" Start Date" name="filter_start_date" date="start_date" />
                        <separator/>
                        <filter string="Self" name="filter_self_record" domain="[('employee_id.user_id','=',uid)]"/>
                        <separator/>
                        <filter string="Approved" name="filter_status_approved" domain="[('state','=','approved')]" />
                        <separator/>
                        <filter string="Expired" name="filter_status_expired" domain="[('state','=','expired')]" />
                        <separator/>
                        <filter string="Todays Exclusion" name="filter_todays_exclusion" domain="[('exclusion_applied_today','=',True)]" />
                        <separator/>
                        <filter string="No Meal For Today" name="filter_no_meal_for_today" domain="[('no_meal_choice','=',True)]" />
                        
                        <filter string="Employee Name" name="group_by_employee_id" domain="[]" context="{'group_by':'employee_id'}" />
                        <filter string="Start Date" name="group_by_start_date" domain="[]" context="{'group_by':'start_date'}" date="start_date" />
                        <filter string="Status" name="group_by_state" domain="[]" context="{'group_by':'state'}" />
                    </group>
                    <!-- <filter name="last_7_days_meals" string="Last 7 Days" domain="[('start_date','&lt;=',context_today().strftime('%Y-%m-%d')),('start_date', '&gt;',(context_today()-relativedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                    <filter name="last_45_days_attendance" string="Last 15 Days" domain="[('start_date','&lt;=',context_today().strftime('%Y-%m-%d')),('start_date', '&gt;',(context_today()-relativedelta(days=15)).strftime('%Y-%m-%d'))]"/> -->
                </search>
            </field>
        </record>

        <!-- Main window action for "model" -->
        <!-- <record id="action_kw_canteen_regular_meal_act_window" model="ir.actions.act_window">
            <field name="type">ir.actions.act_window</field>
            <field name="name">Regular Meal</field>
            <field name="res_model">kw_canteen_regular_meal</field>
            <field name="view_mode">tree,form</field>
            <field name="view_type">form</field>
            <field name="target">current</field>
            <field name="domain">[]</field>
            <field name="context">{'search_default_filter_self_record':1 ,'search_default_this_month_regular_meal':1}</field>
            <field name="search_view_id" ref="view_kw_canteen_regular_meal_search" />
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    No records created.
                </p>
            </field>
        </record> -->

        <record id="action_kw_canteen_regular_meal_act_window" model="ir.actions.server">
			<field name="name">Regular Meal</field>
			<field name="model_id" ref="model_kw_canteen_regular_meal"/>
			<field name="state">code</field>
            <!-- <field name="context">{'search_default_filter_self_record':1 ,'search_default_this_month_regular_meal':1}</field> -->
            <!-- <field name="search_view_id" ref="view_kw_canteen_regular_meal_search" /> -->
			<field name="code">
				action = model.view_form()
			</field>
		</record>

    </data>
</odoo>