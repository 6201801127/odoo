<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <template id="update_nps_details_web_template" name="NPS">
            <t t-call="website.layout">
                <style>
                    body
                    {
                    background-image: url(/kwantify_theme/static/src/img/_MG_8939.png);
                    background-repeat: no-repeat;
                    background-size: cover;
                    }
                    .site-footer img 
                    {
                    filter: hue-rotate(45deg);
                    }
                    .site-footer
                    {
                    background: #2e5dab!important;
                    color: #fff!important;
                    }
                    .csm-link 
                    {
                    color: #fff!important;
                    }
                    .bg_gradient
                    {
                    display:flex;
                    }
                    .o_main_navbar, .o_affix_enabled { display: none; }
                    .container { max-width: 600px; }
                    .card-header 
                    {
                    background-color: #1d4b7a;
                    color: #fff;
                    text-align: center;
                    }
                    .form-group 
                    {
                    display: flex;
                    align-items: center;
                    margin-bottom: 1.5rem;
                    width: 100%;
                    }
                    .form-label 
                    {
                    font-weight: bold;
                    margin-bottom: 0;
                    width: 54%; /* Fixed width for labels to ensure consistency */
                    flex: 0 0 auto;
                    white-space: normal; /* Allow text wrapping */
                    margin-right: 20px; /* Space between label and input */
                    }
                    .form-control 
                    {
                    flex: 1; /* Take up remaining space */
                    min-width: 200px; /* Minimum width of the input box */
                    max-width: 55%; /* Maximum width of the input box to ensure uniformity */
                    }
                    .text-danger 
                    {
                    color: #dc3545;
                    }
                    .modal-header 
                    {
                    background-color: #343a40;
                    color: #fff;
                    }
                    .modal-body p 
                    {
                    margin-bottom: 0.5rem;
                    }
                    .modal-body p strong 
                    {
                    display: inline-block;
                    width: 150px;
                    }
                    .centered-button 
                    {
                    display: flex;
                    justify-content: center; /* Center horizontally */
                    }
                </style>
                <script>
                    $(document).ready(function () {
                        // Initialize select2 for all select elements
                        function initializeSelect2() {
                            $('.select2').select2({
                                allowClear: true,
                                placeholder: function() {
                                    $(this).data('placeholder');
                                }
                            });
                        }
        
                        initializeSelect2();
        
                        $('#nps_interested').on('change', function () {
                            var selectedValue = $(this).val();
                            if (selectedValue === 'Yes') {
                                $('#pran-question, #percentage-selection').show();
                                $('#pran-question select, #percentage-selection select').select2({
                                    allowClear: true
                                }); // Re-initialize select2 for the shown fields
                            } else {
                                $('#pran-question, #pran-input, #percentage-selection').hide();
                                $('#pran_number').val('');
        
                                // Reset the percentage dropdown and update the UI
                                $('#percentage').val(null).trigger('change');
                                $('#percentage').select2('val', ''); // For select2 to reflect the change in UI
        
                            }
        
                            // Reset the have_pran dropdown and update the UI
                            $('#have_pran').val(null).trigger('change');
                            $('#have_pran').select2('val', ''); // For select2 to reflect the change in UI
                        });
        
                        $('#have_pran').on('change', function () {
                            var selectedValue = $(this).val();
                            if (selectedValue === 'Yes') {
                                $('#pran-input').show();
                                $('#pran-input input').val('').trigger('change');
                            } else {
                                $('#pran-input').hide();
                                $('#pran_number').val('');
                            }
                        });
        
                        $('#npsForm').on('submit', function (e) {
                            e.preventDefault();
                            var formData = $(this).serializeArray();
                            var modalContent = '';
                            var showPranNumber = $('#nps_interested').val() === 'Yes' &amp;&amp; $('#have_pran').val() === 'Yes';
                            var fieldNames = {
                                'NPS_Interested': 'Corporate NPS',
                                'Percentage': 'NPS contribution',
                                'Have_Pran': 'Existing PRAN',
                                'Pran_Number': 'PRAN'
                            };
        
                            $.each(formData, function (i, field) {
                                if (field.name === 'Pran_Number' &amp;&amp; !showPranNumber) {
                                    return;
                                }
                                var fieldName = fieldNames[field.name] || field.name.replace(/_/g, ' ').replace(/\b\w/g, function (l) { return l.toUpperCase(); });
                                modalContent += '<p><strong>' + fieldName + ':</strong> ' + field.value + '</p>';
                            });
        
                            $('#confirmationModal .modal-body').html(modalContent);
                            $('#confirmationModal').modal('show');
                        });
        
                        $('#confirmSubmit').on('click', function () {
                            var formData = $('#npsForm').serialize();
                            $.ajax({
                                type: 'POST',
                                url: '/nps-update-form/',
                                data: formData,
                                dataType: 'json', // Expect JSON response
                                success: function (response) {
                                    if (response.redirect) {
                                        window.location.href = response.redirect; // Redirect to the thank you page
                                    } else {
                                        console.log('Response:', response); // Log response for debugging
                                        alert('Error submitting form! Response status: ' + response.status);
                                    }
                                },
                                error: function (xhr, status, error) {
                                    console.log('Error details:', {
                                        xhr: xhr,
                                        status: status,
                                        error: error
                                    });
                                    alert('Error submitting form! See console for details.');
                                }
                            });
                            $('#confirmationModal').modal('hide'); // Hide modal
                        });
                        $('#handleButtonClick').on('click', function (e) {
                            var nps_interested = $("#nps_interested").val();
                            if (nps_interested === null) {
                                swal("Please update your NPS status!");
                                return false;
                            }
                            var percentage = $("#percentage").val();
                            if (nps_interested === 'Yes' &amp;&amp; (percentage === null || percentage === '')) {
                                swal("Please select the contribution options for NPS!");
                                return false;
                            }
                            var have_pran = $("#have_pran").val();
                            if (nps_interested === 'Yes' &amp;&amp; (have_pran === null || have_pran === '')) {
                                swal("Please update your PRAN status!");
                                return false;
                            }
                            var pran_number = $("#pran_number").val();
                            if (have_pran === 'Yes' &amp;&amp; (pran_number === null || pran_number === '')) {
                                swal("Please update your PRAN number!");
                                return false;
                            }
                            if (have_pran === 'Yes' &amp;&amp; (pran_number.length != 12)) {
                                swal("Please update valid PRAN!");
                                return false;
                            }
                        });
                    });
                </script>
        
                <div class="d-flex align-items-center flex-column justify-content-center py-5 container">
                    <div class="card">
                        <div class="card-header">
                            <span class="h3 text-center">
                                Corporate NPS 
                            </span>
                        </div>
                        <div class="card-body">
                            <form id="npsForm" method="post" action="/nps-update-form/">
                                <div class="form-group">
                                    <label for="nps_interested" class="form-label">
                                        Are you interested in Corporate NPS? <span class="text-danger">*</span>:
                                    </label>
                                    <select class="form-control select2" id="nps_interested" name="NPS_Interested" required="required">
                                        <option selected="selected" disabled="disabled">Select Your Option</option>
                                        <option>Yes</option>
                                        <option>No</option>
                                    </select>
                                </div>
                                <div class="form-group" id="percentage-selection" style="display: none;">
                                    <label for="percentage" class="form-label">
                                        Please select your contribution : <span class="text-danger">*</span>:
                                    </label>
                                    <select class="form-control select2" id="percentage" name="Percentage">
                                        <option selected="selected" disabled="disabled">Select Percentage of Basic Salary</option>
                                        <option>5% of Basic Salary</option>
                                        <option>7% of Basic Salary</option>
                                        <option>10% of Basic Salary</option>
                                        <option>14% of Basic Salary</option>
                                    </select>
                                </div>
                                <div class="form-group" id="pran-question" style="display: none;">
                                    <label for="have_pran" class="form-label">
                                        Do you have existing PRAN? <span class="text-danger">*</span>:
                                    </label>
                                    <select class="form-control select2" id="have_pran" name="Have_Pran">
                                        <option selected="selected" disabled="disabled">Select Your Option</option>
                                        <option>Yes</option>
                                        <option>No</option>
                                    </select>
                                </div>
                                <div class="form-group" id="pran-input" style="display: none;">
                                    <label for="pran_number" class="form-label">
                                        PRAN <span class="text-danger">*</span>:
                                    </label>
                                    <input type="text" class="form-control" id="pran_number" name="Pran_Number" placeholder="Enter PRAN"/>
                                </div>
                                
                                <!-- <div class="form-group centered-button m-0">
                                </div> -->
                                <div class="text-center">
                                    <button type="submit" id="handleButtonClick" class="btn btn-primary">Submit</button>
                                    <t t-if="(skip_log and skip_log.skips_check != 3) or (not skip_log)">
                                        <a class="btn btn-warning btn-md"
                                           t-attf-href="/skip-nps-details/">
                                           <span style="font-size:15px;">Skip
                                               <i class="fa fa-arrow-circle-right"/>
                                           </span>
                                        </a>
                                    </t>               
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
        
                <!-- Confirmation Modal -->
                <div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="confirmationModalLabel">Confirm Your Details</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true"></span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <!-- Dynamic content will be loaded here -->
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                <button type="button" id="confirmSubmit" class="btn btn-primary">Confirm</button>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>
        
        

        <template id="nps_details_submission_template" name="nps_submission_template">
            <t t-call="website.layout">
                <style>
                    .o_main_navbar, .o_affix_enabled{display:none;}
                </style>
                <div class="wrap">
                    <div class="container">
                        <section class="service-request mt32">
                            <div class="container card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-12 mx-auto">
                                            <div class="section__content text-center">
                                                <div class="swal2-icon swal2-success swal2-animate-success-icon" style="display: flex;" data-oe-model="ir.ui.view" data-oe-id="1641" data-oe-field="arch" data-oe-xpath="/t[1]/t[1]/div[1]/div[1]/div[1]/div[1]">
                                                    <span class="swal2-success-line-tip"/>
                                                    <span class="swal2-success-line-long"/>
                                                    <div class="swal2-success-ring"/>
                                                </div>
                                                <h2 class="display-6 text-center font-weight-bold mt-6 mb-4">
                                                Thank you!
                                                    <br/>
                                                Your NPS details has been submitted successfully.
                                                </h2>
                                                <a class="btn btn-primary btn-lg" style="background-color: #f7941d !important;" t-attf-href="/web">
                                                    <i class="fa fa-arrow-circle-left "/>
                                                &amp;nbsp;
                                                Go To Dashboard
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </t>
        </template>

        <template id="nps_form_style" inherit_id="update_nps_details_web_template">
            <xpath expr="." position="inside">
                <link href="/kwantify_theme/static/src/mdb/css/mdb.min.css" rel="stylesheet"/>
                <script type="text/javascript" src="/kwantify_theme/static/src/mdb/js/mdb.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.1/jquery.validate.min.js"></script>
                <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0/js/select2.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.5.2/js/bootstrap.min.js"></script>
                <!-- <script type="text/javascript" src="/payroll_inherit/static/js/nps.js"></script> -->
            </xpath>
        </template>
    </data>
</odoo>
