<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<data>
		<record id="nps_employee_data_view_form" model="ir.ui.view">
			<field name="name">nps_employee_data_view_form</field>
			<field name="model">nps_employee_data</field>
			<field name="arch" type="xml">
				<form>
					<sheet>
						<group>
							<group>
								<field name="employee_id" options="{'no_open': True,'no_create':True,'no_edit':True}" readonly='1' force_save='1'/>
								<field name="is_nps" required='1' string="If Interested in Corporate NPS ?"/>
								<field name="contribution" attrs="{'required': [('is_nps','=','Yes')], 'invisible':['|',('is_nps','=','No'),('is_nps','=',False)]}" string="Contribution Options"/>
								<field name="existing_pran_no" attrs="{'required': [('is_nps','=','Yes')], 'invisible':['|',('is_nps','=','No'),('contribution','=',False)]}" string="Do you have existing PRAN?"/>
								<field name="pran_no" attrs="{'required': [('existing_pran_no','=','Yes')], 'invisible':['|','|',('is_nps','=','No'),('existing_pran_no','=','No'),('existing_pran_no','=',False)]}" string="PRAN"/>
								<field name="remark_of_apply" required='1' attrs="{'invisible':[('is_nps','=',False)]}"/>
								<field name="state" invisible = '1' force_save='1'/>
								<field name="emp_profile_id" force_save='1' invisible = '1'/>
								<field name="emp_contract_id" force_save='1' invisible = '1'/>
							</group>
						</group>
					</sheet>
				</form>
			</field>
		</record>
	</data>





	<data>
		<record id="nps_update_data_view_tree" model="ir.ui.view">
			<field name="name">nps_update_data_view_tree</field>
			<field name="model">nps_update_data</field>
			<field name="arch" type="xml">
				<tree editable = 'top' create='0' delete='0' import='0' decoration-danger="state == 'Rejected'" decoration-success="state == 'Approved'">
					<field name="nps_id" invisible='1'/>
					<field name="employee_id" readonly='1' force_save='1' options="{'no_open': True,'no_create':True,'no_edit':True}" invisible='1'/>
					<field name="job_branch_id" options="{'no_open': True,'no_create':True,'no_edit':True}"/>
					<field name="department_id" options="{'no_open': True,'no_create':True,'no_edit':True}"/>
					<field name="employee_code"/>
					<field name="employee_name"/>
					<field name="job_id" options="{'no_open': True,'no_create':True,'no_edit':True}"/>
					<field name="date_of_joining"/>
					<field name="date_of_birth"/>
					<field name="work_email"/>
					<field name="is_nps" readonly='1'/>
					<field name="contribution" readonly='1'/>
					<field name="existing_pran_no" readonly='1'/>
					<field name="pran_no" force_save='1' attrs="{'readonly':[('state','!=','Requested')]}"/>
					<field name="state" readonly='1'/>
					<field name="create_date" readonly='1' string='Requested On' widget='date'/>
					<field name="remark" readonly='1' force_save='1' invisible='1'/>
					<field name="remark_of_action" readonly='1' force_save='1'/>
					<button name="view_details_nps" string="View/Take Action" class="btn btn-warning" type="object"/>
				</tree>
			</field>
		</record>
		<record id="nps_update_data_view_form" model="ir.ui.view">
			<field name="name">nps_update_data_view_form</field>
			<field name="model">nps_update_data</field>
			<field name="arch" type="xml">
				<form>
					<sheet>
						<group>
							<group>
								<field name="employee_id" invisible='1' force_save='1'/>
								<field name="emp_contract_id" invisible='1' force_save='1'/>
								<field name="nps_id" force_save='1' invisible='1'/>
								<field name="state" invisible='1'/>
								<field name="is_nps" required='1' string="If Interested in Corporate NPS ?"/>
								<field name="contribution" attrs="{'invisible': ['|',('is_nps','=','No'),('is_nps','=',False)], 'required': [('is_nps','=','Yes')]}" string="Contribution Options"/>
								<field name="existing_pran_no" attrs="{'invisible': ['|',('is_nps','=','No'),('is_nps','=',False)], 'required': [('is_nps','=','Yes')]}" string="Do you have existing PRAN?"/>
								<field name="pran_no" attrs="{'invisible': ['|','|',('is_nps','=','No'),('is_nps','=',False),('existing_pran_no','=','No')], 'required': [('is_nps','=','Yes'),('existing_pran_no','=','Yes')]}" string="PRAN"/>
								<field name="remark" required='1' attrs="{'invisible':[('is_nps','=',False)]}"/>
							</group>
						</group>
						<footer>
							<center>
								<button name="submit_nps_details"  string="Submit" class="btn btn-success" type="object"/>
							</center>
						</footer>
					</sheet>
				</form>
			</field>
		</record>
		<record id="nps_update_data_view_form_manager" model="ir.ui.view">
			<field name="name">nps_update_data_view_form_manager</field>
			<field name="model">nps_update_data</field>
			<field name="arch" type="xml">
				<form create='0' delete='0' edit='1' import='0'>
					<header>
						<button name="take_action_single_bulk_nps_data" string=" Take Action" type="object" class="oe_highlight fa fa-gears" groups='kw_employee.group_payroll_manager,hr_payroll.group_hr_payroll_manager' attrs="{'invisible': [('state','!=','Requested')]}"/>
						<button name="manual_rejection_nps_update_data" string=" Manual Rejection" type="object" class="oe_highlight fa fa-gears" groups='kw_employee.group_payroll_manager,hr_payroll.group_hr_payroll_manager' attrs="{'invisible': [('state','!=','Approved')]}"/>
						<field name="state" widget="statusbar"/>
					</header>
					<sheet>
						<group>
							<group rowspan='1' string='Employee Details'>
								<field name="employee_id" readonly='1' force_save='1' options="{'no_open': True,'no_create':True,'no_edit':True}" invisible='1'/>
								<field name="employee_code"/>
								<field name="employee_name"/>
								<field name="department_id" options="{'no_open': True,'no_create':True,'no_edit':True}"/>
								<field name="job_branch_id" options="{'no_open': True,'no_create':True,'no_edit':True}"/>
								<field name="work_email"/>
								<field name="date_of_joining"/>
							</group>
							<group rowspan='2' string='NPS Details'>
								<field name="is_nps" readonly='1'/>
								<field name="contribution" readonly='1'/>
								<field name="existing_pran_no" readonly='1'/>
								<field name="pran_no" attrs="{'readonly': [('state','!=','Requested')]}"/>
								<field name="remark" readonly='1'/>
							</group>
						</group>
						<group string='Activity Log'>
							<group>
								<field name="create_date" readonly='1'/>
								<field name="action_taken_on" readonly='1'/>
								<field name="action_taken_by" readonly='1' options="{'no_open': True,'no_create':True,'no_edit':True}"/>
								<field name="remark_of_action" readonly='1' force_save='1'/>
							</group>
						</group>
					</sheet>
				</form>
			</field>
		</record>
		<record id="nps_update_data_search_view" model="ir.ui.view">
			<field name="name">nps_update_data_search_view</field>
			<field name="model">nps_update_data</field>
			<field name="arch" type="xml">
				<search>
					<field name="employee_id" string="Employee"/>
					<filter string="Requested" name="state_requested" domain="[('state','=','Requested')]"/>
					<filter string="Approved" name="state_approved" domain="[('state','=','Approved')]"/>
					<filter string="Rejected" name="state_rejected" domain="[('state','=','Rejected')]"/>
				</search>
			</field>
		</record>
		<record id="payroll_nps_approval_action" model="ir.actions.act_window">
			<field name="name">NPS Approval Requests</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">nps_update_data</field>
			<field name="view_mode">tree,form</field>
			<field name="view_type">form</field>
			<field name="search_view_id" ref="nps_update_data_search_view"/>
			<field name="context">{'search_default_state_requested': 1}</field>
			<field name="view_ids" eval="[(5, 0, 0),
                     (0, 0, {'view_mode': 'tree', 'view_id': ref('nps_update_data_view_tree')}),
                     (0, 0, {'view_mode': 'form', 'view_id': ref('nps_update_data_view_form_manager')})]"/>
		</record>

		<menuitem id="payroll_nps_update_data_menu" name="NPS Request Approval" parent="payroll_inherit.process_payroll_menu" action="payroll_nps_approval_action" sequence="99" />
	</data>








	<data>
		<record id="take_action_nps_action_wizard_form" model="ir.ui.view">
			<field name="name">take_action_nps_action_wizard_form</field>
			<field name="model">nps_action_wizard</field>
			<field name="arch" type="xml">
				<form>
					<sheet>
						<group>
							<field name="remark" placeholder="Remark required in case of Rejection...!"/>
						</group>
					</sheet>
					<footer>
						<center>
							<button name="action_approve_bulk_nps_data" string="Approve" type="object" class=" btn btn-success" groups='kw_employee.group_payroll_manager,hr_payroll.group_hr_payroll_manager' style="margin-right: 10px;"/>
							<button name="action_reject_bulk_nps_data" string="Reject" type="object" class=" btn btn-danger" groups='kw_employee.group_payroll_manager,hr_payroll.group_hr_payroll_manager' style="margin-right: 10px;"/>
							<button string="Close" class="btn-secondary" special="cancel"/>
						</center>
					</footer>
				</form>
			</field>
		</record>
		<act_window id="action_approve_nps_wizard" name="Take Action" src_model="nps_update_data" res_model="nps_action_wizard" view_type="form" view_mode="form" 
		view_id="take_action_nps_action_wizard_form" key2="client_action_multi" target="new" context="{'selected_active_ids':active_ids}" />
	</data>
</odoo>